/* ============================================
   SCFA Interactive Research Story - Enhanced Styles
   With Author Info, Terminology, Architecture, 
   Animated Equations & Statistics Highlighting
   ============================================ */

/* CSS Variables */
:root {
    --primary: #2962ff;
    --rq1: #2196f3;
    --rq2: #4caf50;
    --rq3: #ff9800;
    --purple: #9c27b0;
    --red: #f44336;
    --teal: #009688;
    --dark: #1a1a2e;
    --darker: #0f0f1a;
    --light: #fafafa;
    --text: #e0e0e0;
    --text-muted: #9e9e9e;
    --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-blue: linear-gradient(135deg, #2962ff 0%, #00bcd4 100%);
    --gradient-green: linear-gradient(135deg, #4caf50 0%, #00bcd4 100%);
    --gradient-orange: linear-gradient(135deg, #ff9800 0%, #f44336 100%);
    --shadow: 0 10px 40px rgba(0,0,0,0.3);
    --shadow-light: 0 5px 20px rgba(0,0,0,0.2);
}

/* Reset & Base */
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--darker);
    color: var(--text);
    overflow: hidden;
    height: 100vh;
    line-height: 1.6;
}

/* ============================================
   HANDWRITTEN NOTES PANELS
   Real-time sketchy notes & flowcharts
   ============================================ */

/* Panel Base Styles */
.handwritten-panel {
    position: fixed;
    top: 80px;
    width: 280px;
    height: calc(100vh - 160px);
    background: linear-gradient(135deg, rgba(20, 20, 30, 0.95), rgba(30, 30, 45, 0.92));
    border-radius: 15px;
    z-index: 100;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    transition: transform 0.3s ease, opacity 0.3s ease;
}

.handwritten-panel.left-panel {
    left: 15px;
    border: 2px solid rgba(255, 193, 7, 0.3);
}

.handwritten-panel.right-panel {
    right: 15px;
    border: 2px solid rgba(76, 175, 80, 0.3);
}

.handwritten-panel.hidden {
    transform: translateX(-100%);
    opacity: 0;
    pointer-events: none;
}

.handwritten-panel.right-panel.hidden {
    transform: translateX(100%);
}

/* Panel Header */
.panel-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 15px;
    background: rgba(0, 0, 0, 0.4);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.panel-icon {
    font-size: 1.2rem;
}

.panel-title {
    font-family: 'Caveat', cursive;
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--light);
    flex: 1;
}

.panel-clear {
    background: rgba(244, 67, 54, 0.2);
    border: 1px solid rgba(244, 67, 54, 0.4);
    border-radius: 8px;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.panel-clear:hover {
    background: rgba(244, 67, 54, 0.4);
}

.panel-toggle {
    display: flex;
    gap: 5px;
}

.toggle-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 5px;
    padding: 4px 10px;
    font-size: 0.7rem;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s ease;
}

.toggle-btn.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

/* Panel Content */
.panel-content {
    flex: 1;
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 10px;
}

.sketch-canvas, .flow-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.notes-container {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.stats-container {
    position: relative;
    z-index: 1;
}

.stats-container.hidden {
    display: none;
}

/* Handwritten Note Items */
.handwritten-note {
    font-family: 'Caveat', cursive;
    padding: 10px 12px;
    border-radius: 8px;
    opacity: 0;
    transform: translateY(10px);
    animation: noteAppear 0.5s ease forwards;
    position: relative;
}

@keyframes noteAppear {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.handwritten-note.keyword {
    background: rgba(255, 193, 7, 0.15);
    border-left: 3px solid #ffc107;
    color: #fff59d;
    font-size: 1.1rem;
}

.handwritten-note.stat {
    background: rgba(76, 175, 80, 0.15);
    border-left: 3px solid #4caf50;
    color: #a5d6a7;
    font-size: 1.2rem;
    font-weight: 600;
}

.handwritten-note.method {
    background: rgba(156, 39, 176, 0.15);
    border-left: 3px solid #9c27b0;
    color: #ce93d8;
    font-size: 1rem;
}

.handwritten-note.important {
    background: rgba(244, 67, 54, 0.15);
    border-left: 3px solid #f44336;
    color: #ef9a9a;
    font-size: 1.15rem;
}

.handwritten-note.insight {
    background: rgba(33, 150, 243, 0.15);
    border-left: 3px solid #2196f3;
    color: #90caf9;
    font-size: 1.1rem;
}

.handwritten-note.formula {
    background: rgba(255, 152, 0, 0.15);
    border-left: 3px solid #ff9800;
    color: #ffcc80;
    font-family: 'Kalam', cursive;
    font-size: 1rem;
}

/* Note type badges */
.note-type {
    display: inline-block;
    font-family: 'Patrick Hand', cursive;
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 10px;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.handwritten-note.keyword .note-type {
    background: rgba(255, 193, 7, 0.3);
    color: #ffc107;
}

.handwritten-note.stat .note-type {
    background: rgba(76, 175, 80, 0.3);
    color: #4caf50;
}

.handwritten-note.method .note-type {
    background: rgba(156, 39, 176, 0.3);
    color: #9c27b0;
}

.handwritten-note.important .note-type {
    background: rgba(244, 67, 54, 0.3);
    color: #f44336;
}

.handwritten-note.insight .note-type {
    background: rgba(33, 150, 243, 0.3);
    color: #2196f3;
}

.handwritten-note.formula .note-type {
    background: rgba(255, 152, 0, 0.3);
    color: #ff9800;
}

/* Underline animation for emphasis */
.note-text {
    display: block;
    position: relative;
}

.note-text.underline::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: currentColor;
    animation: underlineDraw 0.8s ease forwards 0.3s;
}

@keyframes underlineDraw {
    to {
        width: 100%;
    }
}

/* Flow chart nodes in right panel */
.flow-node {
    position: absolute;
    font-family: 'Patrick Hand', cursive;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 0.85rem;
    opacity: 0;
    transform: scale(0.8);
    animation: nodePopIn 0.4s ease forwards;
    text-align: center;
    max-width: 120px;
}

@keyframes nodePopIn {
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.flow-node.concept {
    background: rgba(33, 150, 243, 0.2);
    border: 2px dashed #2196f3;
    color: #90caf9;
}

.flow-node.process {
    background: rgba(156, 39, 176, 0.2);
    border: 2px solid #9c27b0;
    color: #ce93d8;
}

.flow-node.result {
    background: rgba(76, 175, 80, 0.2);
    border: 2px solid #4caf50;
    color: #a5d6a7;
}

.flow-node.warning {
    background: rgba(255, 152, 0, 0.2);
    border: 2px solid #ff9800;
    color: #ffcc80;
}

/* Stats display in right panel */
.stat-card {
    font-family: 'Caveat', cursive;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 10px;
    opacity: 0;
    animation: statSlideIn 0.5s ease forwards;
}

@keyframes statSlideIn {
    from {
        opacity: 0;
        transform: translateX(20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.stat-card .stat-value {
    font-size: 2rem;
    font-weight: 700;
    display: block;
}

.stat-card .stat-label {
    font-size: 1rem;
    color: var(--text-muted);
}

.stat-card.highlight {
    background: rgba(76, 175, 80, 0.15);
    border: 2px solid rgba(76, 175, 80, 0.4);
}

.stat-card.highlight .stat-value {
    color: #4caf50;
}

.stat-card.warning {
    background: rgba(255, 152, 0, 0.15);
    border: 2px solid rgba(255, 152, 0, 0.4);
}

.stat-card.warning .stat-value {
    color: #ff9800;
}

.stat-card.info {
    background: rgba(33, 150, 243, 0.15);
    border: 2px solid rgba(33, 150, 243, 0.4);
}

.stat-card.info .stat-value {
    color: #2196f3;
}

.no-stats {
    font-family: 'Caveat', cursive;
    font-size: 1.1rem;
    color: var(--text-muted);
    text-align: center;
    padding: 30px 15px;
    opacity: 0.7;
}

/* ============================================
   HYPOTHESIS SPACE REDUCTION SLIDE - REDESIGNED
   ============================================ */

.scene[data-scene="20"] .scene-content.hypothesis-space-scene {
    max-width: 1400px !important;
    padding: 20px !important;
}

.scene[data-scene="20"] .scene-subtitle {
    margin-bottom: 25px !important;
    font-size: 1.1rem !important;
}

/* Section Styling */
.scene[data-scene="20"] .hsr-section {
    margin-bottom: 35px !important;
    background: rgba(0, 0, 0, 0.25) !important;
    border-radius: 15px !important;
    padding: 20px 25px !important;
    border-left: 4px solid var(--primary) !important;
    display: block !important;
}

.scene[data-scene="20"] .section-header {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
    margin-bottom: 18px !important;
}

.scene[data-scene="20"] .section-number {
    width: 32px !important;
    height: 32px !important;
    background: var(--gradient-primary) !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-weight: 700 !important;
    font-size: 1rem !important;
    color: white !important;
    flex-shrink: 0 !important;
}

.scene[data-scene="20"] .section-header h3 {
    font-size: 1.2rem !important;
    color: var(--light) !important;
    margin: 0 !important;
}

/* Section 1: Visual Container */
.scene[data-scene="20"] .hsr-row {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 25px !important;
    margin-bottom: 20px !important;
}

.scene[data-scene="20"] .hsr-visual-container {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 15px !important;
    background: rgba(0, 0, 0, 0.3) !important;
    border-radius: 12px !important;
    padding: 20px !important;
}

.scene[data-scene="20"] .hypothesis-circle {
    width: 150px !important;
    height: 150px !important;
    border-radius: 50% !important;
    background: radial-gradient(circle, rgba(244, 67, 54, 0.15) 0%, rgba(244, 67, 54, 0.3) 100%) !important;
    border: 3px dashed rgba(244, 67, 54, 0.6) !important;
    position: relative !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    flex-shrink: 0 !important;
}

.scene[data-scene="20"] .hypothesis-circle .circle-label {
    font-size: 0.7rem !important;
    color: var(--text-muted) !important;
    text-align: center !important;
}

.scene[data-scene="20"] .hypothesis-circle .circle-value {
    font-size: 0.9rem !important;
    font-weight: 700 !important;
    color: #f44336 !important;
}

.scene[data-scene="20"] .valid-region-inner {
    position: absolute !important;
    width: 70px !important;
    height: 70px !important;
    background: radial-gradient(circle, rgba(76, 175, 80, 0.3) 0%, rgba(76, 175, 80, 0.5) 100%) !important;
    border: 2px solid #4caf50 !important;
    border-radius: 50% !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    animation: validPulse 2s ease-in-out infinite !important;
}

@keyframes validPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4); }
    50% { box-shadow: 0 0 15px 5px rgba(76, 175, 80, 0.3); }
}

.scene[data-scene="20"] .valid-label {
    font-size: 0.6rem !important;
    color: #4caf50 !important;
    text-align: center !important;
    line-height: 1.2 !important;
}

.scene[data-scene="20"] .valid-value {
    font-size: 0.75rem !important;
    font-weight: 700 !important;
    color: #4caf50 !important;
}

/* Animated dots */
.scene[data-scene="20"] .dot {
    position: absolute !important;
    width: 8px !important;
    height: 8px !important;
    border-radius: 50% !important;
    transition: all 0.5s ease !important;
}

.scene[data-scene="20"] .invalid-dot {
    background: #f44336 !important;
    opacity: 0.5 !important;
}

.scene[data-scene="20"] .valid-dot {
    background: #4caf50 !important;
}

.scene[data-scene="20"] .reduction-arrow-visual {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    gap: 5px !important;
}

.scene[data-scene="20"] .arrow-svg {
    width: 80px !important;
    height: 30px !important;
}

.scene[data-scene="20"] .arrow-label-text {
    font-size: 0.75rem !important;
    color: #4caf50 !important;
    font-weight: 600 !important;
}

.scene[data-scene="20"] .result-circle {
    width: 100px !important;
    height: 100px !important;
    border-radius: 50% !important;
    background: radial-gradient(circle, rgba(76, 175, 80, 0.2) 0%, rgba(76, 175, 80, 0.4) 100%) !important;
    border: 3px solid #4caf50 !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    text-align: center !important;
    flex-shrink: 0 !important;
}

.scene[data-scene="20"] .result-circle .circle-label {
    font-size: 0.65rem !important;
    color: var(--text-muted) !important;
}

.scene[data-scene="20"] .result-circle .circle-value {
    font-size: 0.85rem !important;
    font-weight: 700 !important;
}

.scene[data-scene="20"] .highlight-green {
    color: #4caf50 !important;
}

/* Reduction Steps */
.scene[data-scene="20"] .reduction-steps-container {
    display: flex !important;
    flex-direction: column !important;
    gap: 10px !important;
}

.scene[data-scene="20"] .reduction-step {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
    background: rgba(255, 255, 255, 0.05) !important;
    border-radius: 10px !important;
    padding: 12px 15px !important;
}

.scene[data-scene="20"] .step-badge {
    font-size: 1.5rem !important;
    flex-shrink: 0 !important;
}

.scene[data-scene="20"] .step-info {
    flex: 1 !important;
}

.scene[data-scene="20"] .step-title {
    font-size: 0.9rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
}

.scene[data-scene="20"] .step-desc {
    font-size: 0.75rem !important;
    color: var(--text-muted) !important;
}

.scene[data-scene="20"] .step-reduction {
    font-size: 1rem !important;
    font-weight: 700 !important;
    color: #f44336 !important;
    min-width: 50px !important;
    text-align: right !important;
}

.scene[data-scene="20"] .total-reduction-box {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 10px !important;
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(33, 150, 243, 0.2)) !important;
    border: 1px solid rgba(76, 175, 80, 0.4) !important;
    border-radius: 10px !important;
    padding: 12px !important;
    margin-top: 5px !important;
}

.scene[data-scene="20"] .equals-sign {
    font-size: 1.3rem !important;
    color: var(--text-muted) !important;
}

.scene[data-scene="20"] .total-text {
    font-size: 1.1rem !important;
    font-weight: 700 !important;
    color: #4caf50 !important;
}

/* Math Definition Box */
.scene[data-scene="20"] .math-definition-box {
    background: rgba(156, 39, 176, 0.1) !important;
    border: 1px solid rgba(156, 39, 176, 0.3) !important;
    border-radius: 12px !important;
    padding: 15px 20px !important;
}

.scene[data-scene="20"] .math-header {
    font-size: 0.85rem !important;
    color: #ce93d8 !important;
    font-weight: 600 !important;
    margin-bottom: 10px !important;
}

.scene[data-scene="20"] .math-formula {
    font-family: 'Kalam', cursive !important;
    font-size: 1.1rem !important;
    color: var(--light) !important;
    text-align: center !important;
    background: rgba(0, 0, 0, 0.3) !important;
    padding: 12px !important;
    border-radius: 8px !important;
    margin-bottom: 10px !important;
}

.scene[data-scene="20"] .math-vars {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 15px !important;
    font-size: 0.8rem !important;
    color: var(--text-muted) !important;
}

.scene[data-scene="20"] .math-vars span {
    flex: 1 1 200px !important;
}

.scene[data-scene="20"] .math-vars strong {
    color: #ce93d8 !important;
}

/* Section 2: Factors */
.scene[data-scene="20"] .factors-row {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 15px !important;
    margin-bottom: 15px !important;
}

.scene[data-scene="20"] .factor-box {
    background: rgba(0, 0, 0, 0.3) !important;
    border-radius: 12px !important;
    padding: 15px !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    transition: all 0.3s ease !important;
}

.scene[data-scene="20"] .factor-box:hover {
    border-color: var(--primary) !important;
    transform: translateY(-3px) !important;
}

.scene[data-scene="20"] .factor-emoji {
    font-size: 1.8rem !important;
    margin-bottom: 8px !important;
}

.scene[data-scene="20"] .factor-name {
    font-size: 0.9rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
    margin-bottom: 5px !important;
}

.scene[data-scene="20"] .factor-detail {
    font-size: 0.75rem !important;
    color: var(--text-muted) !important;
    margin-bottom: 10px !important;
}

.scene[data-scene="20"] .factor-example-box {
    background: rgba(255, 255, 255, 0.05) !important;
    border-radius: 8px !important;
    padding: 8px !important;
    margin-bottom: 10px !important;
    font-size: 0.7rem !important;
}

.scene[data-scene="20"] .weak-example {
    color: #ff9800 !important;
    text-decoration: line-through !important;
    opacity: 0.7 !important;
    margin-bottom: 3px !important;
}

.scene[data-scene="20"] .strong-example {
    color: #4caf50 !important;
}

.scene[data-scene="20"] .formula-example {
    font-family: 'Kalam', cursive !important;
    color: #ce93d8 !important;
}

.scene[data-scene="20"] .impact-meter {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.scene[data-scene="20"] .impact-fill {
    height: 6px !important;
    background: linear-gradient(90deg, #4caf50, #8bc34a) !important;
    border-radius: 3px !important;
}

.scene[data-scene="20"] .impact-label {
    font-size: 0.65rem !important;
    color: var(--text-muted) !important;
    white-space: nowrap !important;
}

.scene[data-scene="20"] .threshold-warning-box {
    display: flex !important;
    gap: 15px !important;
    background: linear-gradient(135deg, rgba(255, 152, 0, 0.15), rgba(244, 67, 54, 0.15)) !important;
    border: 1px solid rgba(255, 152, 0, 0.4) !important;
    border-radius: 12px !important;
    padding: 15px !important;
}

.scene[data-scene="20"] .warning-icon {
    font-size: 2rem !important;
}

.scene[data-scene="20"] .warning-title {
    font-size: 1rem !important;
    font-weight: 600 !important;
    color: #ff9800 !important;
    margin-bottom: 5px !important;
}

.scene[data-scene="20"] .warning-text {
    font-size: 0.85rem !important;
    color: var(--text) !important;
}

/* Section 3: Why Comparison */
.scene[data-scene="20"] .why-comparison {
    display: grid !important;
    grid-template-columns: 1fr auto 1fr !important;
    gap: 20px !important;
    align-items: center !important;
    margin-bottom: 15px !important;
}

.scene[data-scene="20"] .why-box {
    background: rgba(0, 0, 0, 0.3) !important;
    border-radius: 12px !important;
    padding: 15px !important;
}

.scene[data-scene="20"] .problem-box {
    border: 2px solid rgba(244, 67, 54, 0.4) !important;
}

.scene[data-scene="20"] .solution-box {
    border: 2px solid rgba(76, 175, 80, 0.4) !important;
}

.scene[data-scene="20"] .why-header {
    font-size: 1rem !important;
    font-weight: 600 !important;
    margin-bottom: 12px !important;
    text-align: center !important;
}

.scene[data-scene="20"] .problem-box .why-header { color: #f44336 !important; }
.scene[data-scene="20"] .solution-box .why-header { color: #4caf50 !important; }

.scene[data-scene="20"] .why-list {
    list-style: none !important;
    padding: 0 !important;
    margin: 0 !important;
}

.scene[data-scene="20"] .why-list li {
    font-size: 0.85rem !important;
    margin-bottom: 8px !important;
    padding-left: 20px !important;
    position: relative !important;
}

.scene[data-scene="20"] .why-list li::before {
    content: '•' !important;
    position: absolute !important;
    left: 0 !important;
    color: #f44336 !important;
}

.scene[data-scene="20"] .why-list.success li::before {
    content: '✓' !important;
    color: #4caf50 !important;
}

.scene[data-scene="20"] .transform-arrow {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    gap: 5px !important;
}

.scene[data-scene="20"] .arrow-body {
    font-size: 2rem !important;
    color: var(--primary) !important;
    animation: arrowBounce 1s ease-in-out infinite !important;
}

@keyframes arrowBounce {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(5px); }
}

.scene[data-scene="20"] .arrow-text {
    font-size: 0.7rem !important;
    color: var(--text-muted) !important;
    text-align: center !important;
}

.scene[data-scene="20"] .snr-formula-box {
    background: rgba(33, 150, 243, 0.1) !important;
    border: 1px solid rgba(33, 150, 243, 0.3) !important;
    border-radius: 10px !important;
    padding: 15px !important;
}

.scene[data-scene="20"] .formula-row {
    display: flex !important;
    align-items: center !important;
    gap: 15px !important;
    margin-bottom: 8px !important;
}

.scene[data-scene="20"] .formula-row:last-child {
    margin-bottom: 0 !important;
}

.scene[data-scene="20"] .formula-label {
    font-size: 0.8rem !important;
    color: var(--text-muted) !important;
    min-width: 50px !important;
}

.scene[data-scene="20"] .formula-content {
    font-family: 'Kalam', cursive !important;
    font-size: 0.95rem !important;
    color: var(--light) !important;
}

.scene[data-scene="20"] .highlight-formula {
    background: rgba(76, 175, 80, 0.1) !important;
    padding: 10px !important;
    border-radius: 8px !important;
}

.scene[data-scene="20"] .green-text {
    color: #4caf50 !important;
}

/* Section 4: Novelty Pipeline */
.scene[data-scene="20"] .novelty-pipeline {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 10px !important;
    flex-wrap: wrap !important;
    margin-bottom: 20px !important;
}

.scene[data-scene="20"] .pipeline-stage {
    background: rgba(0, 0, 0, 0.3) !important;
    border: 2px solid rgba(255, 255, 255, 0.15) !important;
    border-radius: 12px !important;
    padding: 12px !important;
    text-align: center !important;
    min-width: 120px !important;
    transition: all 0.3s ease !important;
}

.scene[data-scene="20"] .pipeline-stage.highlight-stage {
    background: rgba(76, 175, 80, 0.15) !important;
    border-color: #4caf50 !important;
    transform: scale(1.05) !important;
}

.scene[data-scene="20"] .stage-emoji {
    font-size: 1.8rem !important;
    margin-bottom: 5px !important;
}

.scene[data-scene="20"] .stage-name {
    font-size: 0.8rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
    margin-bottom: 3px !important;
}

.scene[data-scene="20"] .stage-detail {
    font-size: 0.7rem !important;
    color: var(--text-muted) !important;
    margin-bottom: 5px !important;
}

.scene[data-scene="20"] .stage-stat {
    font-size: 0.75rem !important;
    font-weight: 600 !important;
    color: #4caf50 !important;
}

.scene[data-scene="20"] .pipeline-arrow {
    font-size: 1.5rem !important;
    color: #4caf50 !important;
}

.scene[data-scene="20"] .key-insight-box {
    display: flex !important;
    gap: 15px !important;
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 152, 0, 0.15)) !important;
    border: 2px solid rgba(255, 193, 7, 0.4) !important;
    border-radius: 12px !important;
    padding: 15px !important;
    margin-bottom: 15px !important;
}

.scene[data-scene="20"] .insight-icon {
    font-size: 2rem !important;
}

.scene[data-scene="20"] .insight-text {
    font-size: 0.9rem !important;
    line-height: 1.5 !important;
}

.scene[data-scene="20"] .insight-text strong {
    color: #ffc107 !important;
}

/* Comparison Table */
.scene[data-scene="20"] .comparison-table-container {
    overflow-x: auto !important;
}

.scene[data-scene="20"] .comparison-tbl {
    width: 100% !important;
    border-collapse: collapse !important;
    font-size: 0.85rem !important;
}

.scene[data-scene="20"] .comparison-tbl th,
.scene[data-scene="20"] .comparison-tbl td {
    padding: 10px 15px !important;
    text-align: left !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
}

.scene[data-scene="20"] .comparison-tbl th {
    background: rgba(0, 0, 0, 0.4) !important;
    color: var(--light) !important;
    font-weight: 600 !important;
}

.scene[data-scene="20"] .comparison-tbl tr:nth-child(odd) {
    background: rgba(255, 255, 255, 0.03) !important;
}

.scene[data-scene="20"] .comparison-tbl .highlight-row {
    background: rgba(76, 175, 80, 0.15) !important;
}

.scene[data-scene="20"] .bad-val { color: #f44336 !important; }
.scene[data-scene="20"] .med-val { color: #ff9800 !important; }
.scene[data-scene="20"] .good-val { color: #4caf50 !important; }

/* Section 5: Skip Comparison */
.scene[data-scene="20"] .skip-comparison {
    display: grid !important;
    grid-template-columns: 1fr auto 1fr !important;
    gap: 20px !important;
    align-items: start !important;
    margin-bottom: 20px !important;
}

.scene[data-scene="20"] .scenario-box {
    background: rgba(0, 0, 0, 0.3) !important;
    border-radius: 12px !important;
    overflow: hidden !important;
}

.scene[data-scene="20"] .scenario-header {
    padding: 12px 15px !important;
    font-weight: 600 !important;
    font-size: 0.9rem !important;
}

.scene[data-scene="20"] .good-scenario .scenario-header {
    background: rgba(76, 175, 80, 0.2) !important;
    color: #4caf50 !important;
}

.scene[data-scene="20"] .bad-scenario .scenario-header {
    background: rgba(244, 67, 54, 0.2) !important;
    color: #f44336 !important;
}

.scene[data-scene="20"] .metric-row {
    display: flex !important;
    justify-content: space-between !important;
    padding: 8px 15px !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
    font-size: 0.8rem !important;
}

.scene[data-scene="20"] .metric-name {
    color: var(--text-muted) !important;
}

.scene[data-scene="20"] .metric-val {
    font-weight: 600 !important;
}

.scene[data-scene="20"] .metric-val.good { color: #4caf50 !important; }
.scene[data-scene="20"] .metric-val.bad { color: #f44336 !important; }

.scene[data-scene="20"] .vs-badge {
    width: 45px !important;
    height: 45px !important;
    background: var(--gradient-primary) !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-weight: 700 !important;
    font-size: 0.9rem !important;
    color: white !important;
    align-self: center !important;
}

.scene[data-scene="20"] .cascade-impact {
    background: rgba(0, 0, 0, 0.3) !important;
    border-radius: 12px !important;
    padding: 15px !important;
    margin-bottom: 15px !important;
}

.scene[data-scene="20"] .cascade-title {
    font-size: 0.9rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
    margin-bottom: 12px !important;
    text-align: center !important;
}

.scene[data-scene="20"] .cascade-flow {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    flex-wrap: wrap !important;
}

.scene[data-scene="20"] .cascade-step {
    background: rgba(255, 255, 255, 0.05) !important;
    padding: 8px 12px !important;
    border-radius: 8px !important;
    font-size: 0.75rem !important;
}

.scene[data-scene="20"] .cascade-step.danger {
    background: rgba(244, 67, 54, 0.2) !important;
    border: 1px solid rgba(244, 67, 54, 0.4) !important;
    color: #f44336 !important;
    font-weight: 600 !important;
}

.scene[data-scene="20"] .cascade-arrow {
    color: var(--text-muted) !important;
    font-size: 1rem !important;
}

.scene[data-scene="20"] .real-example-box {
    display: flex !important;
    gap: 15px !important;
    background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(156, 39, 176, 0.1)) !important;
    border: 1px solid rgba(33, 150, 243, 0.3) !important;
    border-radius: 12px !important;
    padding: 15px !important;
}

.scene[data-scene="20"] .example-icon {
    font-size: 2.5rem !important;
}

.scene[data-scene="20"] .example-title {
    font-size: 1rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
    margin-bottom: 10px !important;
}

.scene[data-scene="20"] .example-cases {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 15px !important;
}

.scene[data-scene="20"] .example-case {
    padding: 12px !important;
    border-radius: 8px !important;
    font-size: 0.8rem !important;
    line-height: 1.5 !important;
}

.scene[data-scene="20"] .bad-case {
    background: rgba(244, 67, 54, 0.1) !important;
    border: 1px solid rgba(244, 67, 54, 0.3) !important;
}

.scene[data-scene="20"] .good-case {
    background: rgba(76, 175, 80, 0.1) !important;
    border: 1px solid rgba(76, 175, 80, 0.3) !important;
}

.scene[data-scene="20"] .consequence {
    display: block !important;
    margin-top: 5px !important;
    font-size: 0.75rem !important;
}

.scene[data-scene="20"] .bad-case .consequence { color: #f44336 !important; }
.scene[data-scene="20"] .good-case .consequence { color: #4caf50 !important; }

/* Summary Box */
.scene[data-scene="20"] .hsr-summary-box {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(33, 150, 243, 0.15)) !important;
    border: 2px solid rgba(76, 175, 80, 0.4) !important;
    border-radius: 15px !important;
    padding: 20px !important;
}

.scene[data-scene="20"] .summary-header {
    font-size: 1.1rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
    margin-bottom: 15px !important;
    text-align: center !important;
}

.scene[data-scene="20"] .summary-items {
    display: grid !important;
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 12px !important;
}

.scene[data-scene="20"] .summary-item {
    background: rgba(0, 0, 0, 0.3) !important;
    border-radius: 10px !important;
    padding: 12px !important;
}

.scene[data-scene="20"] .summary-label {
    display: block !important;
    font-size: 0.75rem !important;
    text-transform: uppercase !important;
    color: #4caf50 !important;
    font-weight: 600 !important;
    margin-bottom: 5px !important;
}

.scene[data-scene="20"] .summary-value {
    font-size: 0.85rem !important;
    color: var(--text) !important;
    line-height: 1.4 !important;
}

/* ============================================
   HSR MAIN DISPLAY - Clean Static Visualization
   ============================================ */

/* Fullscreen Button */
.scene[data-scene="20"] .fullscreen-btn {
    margin-left: auto !important;
    background: linear-gradient(135deg, #667eea, #764ba2) !important;
    border: none !important;
    color: white !important;
    padding: 8px 16px !important;
    border-radius: 20px !important;
    font-size: 0.8rem !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    display: flex !important;
    align-items: center !important;
    gap: 6px !important;
    transition: all 0.3s ease !important;
}

.scene[data-scene="20"] .fullscreen-btn:hover {
    transform: scale(1.05) !important;
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4) !important;
}

.scene[data-scene="20"] .hsr-main-display {
    display: grid !important;
    grid-template-columns: 1.3fr 1fr !important;
    gap: 25px !important;
    margin-bottom: 20px !important;
}

/* Diagram Panel */
.scene[data-scene="20"] .hsr-diagram-panel {
    background: rgba(0, 0, 0, 0.4) !important;
    border-radius: 15px !important;
    padding: 20px !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

.scene[data-scene="20"] .diagram-title {
    font-size: 0.9rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
    text-align: center !important;
    margin-bottom: 20px !important;
    padding-bottom: 10px !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
}

.scene[data-scene="20"] .diagram-container {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 15px !important;
    padding: 10px 0 !important;
}

/* Space States */
.scene[data-scene="20"] .space-state {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    gap: 10px !important;
}

.scene[data-scene="20"] .state-label {
    font-size: 0.75rem !important;
    color: var(--text-muted) !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
}

.scene[data-scene="20"] .space-circle {
    width: 130px !important;
    height: 130px !important;
    border-radius: 50% !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    position: relative !important;
    transition: all 0.3s ease !important;
}

.scene[data-scene="20"] .full-space {
    background: radial-gradient(circle, rgba(244, 67, 54, 0.1) 0%, rgba(244, 67, 54, 0.25) 100%) !important;
    border: 3px dashed rgba(244, 67, 54, 0.5) !important;
}

.scene[data-scene="20"] .constrained-space {
    background: radial-gradient(circle, rgba(76, 175, 80, 0.15) 0%, rgba(76, 175, 80, 0.35) 100%) !important;
    border: 3px solid rgba(76, 175, 80, 0.7) !important;
    box-shadow: 0 0 20px rgba(76, 175, 80, 0.3) !important;
}

.scene[data-scene="20"] .space-inner-label {
    font-size: 0.7rem !important;
    color: var(--text-muted) !important;
}

.scene[data-scene="20"] .space-value {
    font-size: 1.6rem !important;
    font-weight: 700 !important;
}

.scene[data-scene="20"] .full-space .space-value { color: #f44336 !important; }
.scene[data-scene="20"] .constrained-space .space-value { color: #4caf50 !important; }

.scene[data-scene="20"] .space-unit {
    font-size: 0.7rem !important;
    color: var(--text-muted) !important;
}

.scene[data-scene="20"] .state-desc {
    font-size: 0.7rem !important;
    color: var(--text-muted) !important;
    text-align: center !important;
    line-height: 1.4 !important;
}

/* Invalid/Valid indicators */
.scene[data-scene="20"] .invalid-indicator,
.scene[data-scene="20"] .valid-indicator {
    position: absolute !important;
    width: 8px !important;
    height: 8px !important;
    border-radius: 50% !important;
}

.scene[data-scene="20"] .invalid-indicator { background: #f44336 !important; opacity: 0.6 !important; }
.scene[data-scene="20"] .valid-indicator { background: #4caf50 !important; }

.scene[data-scene="20"] .i1 { top: 15%; left: 20%; }
.scene[data-scene="20"] .i2 { top: 25%; right: 15%; }
.scene[data-scene="20"] .i3 { bottom: 20%; left: 15%; }
.scene[data-scene="20"] .i4 { bottom: 25%; right: 20%; }
.scene[data-scene="20"] .v1 { top: 30%; left: 35%; }
.scene[data-scene="20"] .v2 { top: 45%; right: 30%; }
.scene[data-scene="20"] .v3 { bottom: 35%; left: 40%; }

/* Transform Section */
.scene[data-scene="20"] .transform-section {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    gap: 8px !important;
    min-width: 100px !important;
}

.scene[data-scene="20"] .constraint-labels {
    display: flex !important;
    flex-direction: column !important;
    gap: 3px !important;
}

.scene[data-scene="20"] .c-label {
    font-size: 0.65rem !important;
    padding: 2px 8px !important;
    border-radius: 10px !important;
    text-align: center !important;
}

.scene[data-scene="20"] .c-label.temporal { background: rgba(255, 152, 0, 0.2) !important; color: #ff9800 !important; }
.scene[data-scene="20"] .c-label.causal { background: rgba(33, 150, 243, 0.2) !important; color: #2196f3 !important; }
.scene[data-scene="20"] .c-label.capacity { background: rgba(156, 39, 176, 0.2) !important; color: #9c27b0 !important; }
.scene[data-scene="20"] .c-label.physical { background: rgba(244, 67, 54, 0.2) !important; color: #f44336 !important; }

.scene[data-scene="20"] .big-arrow svg {
    width: 100px !important;
    height: 35px !important;
}

.scene[data-scene="20"] .reduction-badge {
    background: linear-gradient(135deg, #4caf50, #8bc34a) !important;
    color: white !important;
    padding: 4px 12px !important;
    border-radius: 15px !important;
    font-size: 0.75rem !important;
    font-weight: 600 !important;
}

/* Impact Row */
.scene[data-scene="20"] .impact-row {
    display: flex !important;
    justify-content: center !important;
    gap: 15px !important;
    margin-top: 15px !important;
    padding-top: 15px !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    flex-wrap: wrap !important;
}

.scene[data-scene="20"] .impact-item {
    display: flex !important;
    align-items: center !important;
    gap: 6px !important;
    font-size: 0.75rem !important;
    color: var(--text-muted) !important;
    padding: 5px 10px !important;
    background: rgba(255, 255, 255, 0.03) !important;
    border-radius: 20px !important;
}

.scene[data-scene="20"] .impact-item.highlight {
    background: rgba(76, 175, 80, 0.15) !important;
    color: #4caf50 !important;
}

/* Constraint Breakdown Panel */
.scene[data-scene="20"] .constraint-breakdown-panel {
    background: rgba(0, 0, 0, 0.4) !important;
    border-radius: 15px !important;
    padding: 15px !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

.scene[data-scene="20"] .breakdown-title {
    font-size: 0.85rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
    margin-bottom: 12px !important;
    padding-bottom: 8px !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
}

.scene[data-scene="20"] .breakdown-item {
    margin-bottom: 12px !important;
    padding: 10px !important;
    background: rgba(255, 255, 255, 0.03) !important;
    border-radius: 10px !important;
    border-left: 3px solid transparent !important;
}

.scene[data-scene="20"] .breakdown-item[data-type="temporal"] { border-left-color: #ff9800 !important; }
.scene[data-scene="20"] .breakdown-item[data-type="causal"] { border-left-color: #2196f3 !important; }
.scene[data-scene="20"] .breakdown-item[data-type="capacity"] { border-left-color: #9c27b0 !important; }
.scene[data-scene="20"] .breakdown-item[data-type="physical"] { border-left-color: #f44336 !important; }

.scene[data-scene="20"] .breakdown-header {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    margin-bottom: 6px !important;
}

.scene[data-scene="20"] .breakdown-icon {
    font-size: 1rem !important;
}

.scene[data-scene="20"] .breakdown-name {
    flex: 1 !important;
    font-size: 0.85rem !important;
    font-weight: 600 !important;
    color: var(--light) !important;
}

.scene[data-scene="20"] .breakdown-pct {
    font-size: 0.9rem !important;
    font-weight: 700 !important;
    color: #f44336 !important;
}

.scene[data-scene="20"] .breakdown-bar {
    height: 4px !important;
    background: rgba(255, 255, 255, 0.1) !important;
    border-radius: 2px !important;
    margin-bottom: 6px !important;
    overflow: hidden !important;
}

.scene[data-scene="20"] .bar-fill {
    height: 100% !important;
    border-radius: 2px !important;
    transition: width 0.5s ease !important;
}

.scene[data-scene="20"] .bar-fill.temporal { background: #ff9800 !important; }
.scene[data-scene="20"] .bar-fill.causal { background: #2196f3 !important; }
.scene[data-scene="20"] .bar-fill.capacity { background: #9c27b0 !important; }
.scene[data-scene="20"] .bar-fill.physical { background: #f44336 !important; }
.scene[data-scene="20"] .bar-fill.total { background: linear-gradient(90deg, #4caf50, #8bc34a) !important; }

.scene[data-scene="20"] .breakdown-details {
    display: flex !important;
    justify-content: space-between !important;
    font-size: 0.7rem !important;
}

.scene[data-scene="20"] .detail-rule {
    font-family: 'Kalam', cursive !important;
    color: #ce93d8 !important;
}

.scene[data-scene="20"] .detail-desc {
    color: var(--text-muted) !important;
}

/* Total */
.scene[data-scene="20"] .breakdown-total {
    margin-top: 15px !important;
    padding: 12px !important;
    background: rgba(76, 175, 80, 0.1) !important;
    border: 1px solid rgba(76, 175, 80, 0.3) !important;
    border-radius: 10px !important;
}

.scene[data-scene="20"] .total-label {
    font-size: 0.75rem !important;
    color: var(--text-muted) !important;
    margin-bottom: 6px !important;
}

.scene[data-scene="20"] .total-bar {
    height: 8px !important;
    background: rgba(255, 255, 255, 0.1) !important;
    border-radius: 4px !important;
    margin-bottom: 8px !important;
    overflow: hidden !important;
}

.scene[data-scene="20"] .total-stats {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 10px !important;
}

.scene[data-scene="20"] .total-pct {
    font-size: 1.3rem !important;
    font-weight: 700 !important;
    color: #4caf50 !important;
}

.scene[data-scene="20"] .total-arrow {
    color: var(--text-muted) !important;
}

.scene[data-scene="20"] .total-gain {
    font-size: 0.9rem !important;
    font-weight: 600 !important;
    color: #ffc107 !important;
}

/* ============================================
   ENHANCED FULL SCREEN MODAL
   ============================================ */

.hsr-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.95);
    z-index: 10000;
    overflow: auto;
}

.hsr-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.hsr-modal .modal-content {
    width: 98%;
    max-width: 1500px;
    max-height: 98vh;
    background: #0f0f1a;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
}

.hsr-modal .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    flex-wrap: wrap;
    gap: 15px;
}

.hsr-modal .modal-header h2 {
    color: white;
    font-size: 1.3rem;
    margin: 0;
}

.hsr-modal .modal-header-stats {
    display: flex;
    gap: 20px;
}

.hsr-modal .header-stat {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.85rem;
}

.hsr-modal .modal-close {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.3);
    background: transparent;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.hsr-modal .modal-close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
}

.hsr-modal .modal-body {
    flex: 1;
    padding: 15px;
    overflow: auto;
}

.hsr-modal .simulator-layout {
    display: grid;
    grid-template-columns: 1.4fr 1fr;
    gap: 20px;
    height: 100%;
}

/* Simulator Canvas Area */
.hsr-modal .simulator-canvas-area {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 15px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.hsr-modal .simulator-canvas {
    width: 100%;
    flex: 1;
    min-height: 450px;
}

.hsr-modal .simulator-legend {
    display: flex;
    justify-content: center;
    gap: 15px;
    padding-top: 12px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 12px;
    flex-wrap: wrap;
}

.hsr-modal .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.75rem;
    color: #9e9e9e;
}

.hsr-modal .legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
}

.hsr-modal .legend-dot.invalid { background: #f44336; }
.hsr-modal .legend-dot.valid { background: #4caf50; }

.hsr-modal .legend-line {
    width: 18px;
    height: 3px;
    border-radius: 2px;
}

.hsr-modal .legend-line.temporal { background: #ff9800; }
.hsr-modal .legend-line.causal { background: #2196f3; }
.hsr-modal .legend-line.capacity { background: #9c27b0; }
.hsr-modal .legend-line.physical { background: #f44336; }

/* Simulator Controls */
.hsr-modal .simulator-controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
    overflow-y: auto;
}

.hsr-modal .control-section {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 12px;
    padding: 12px 15px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.hsr-modal .control-section.highlight-section {
    background: rgba(102, 126, 234, 0.1);
    border-color: rgba(102, 126, 234, 0.3);
}

.hsr-modal .control-section.formula-section {
    background: rgba(156, 39, 176, 0.1);
    border-color: rgba(156, 39, 176, 0.2);
}

.hsr-modal .control-section h4 {
    font-size: 0.8rem;
    color: #9e9e9e;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.hsr-modal .control-buttons {
    display: flex;
    gap: 8px;
}

.hsr-modal .ctrl-btn {
    flex: 1;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    background: rgba(255, 255, 255, 0.05);
    color: white;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
}

.hsr-modal .ctrl-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
}

.hsr-modal .ctrl-btn.primary {
    background: linear-gradient(135deg, #4caf50, #8bc34a);
    border-color: #4caf50;
}

.hsr-modal .ctrl-btn.primary:hover {
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
}

.hsr-modal .ctrl-btn.primary.playing {
    background: linear-gradient(135deg, #ff9800, #f44336);
    border-color: #ff9800;
}

.hsr-modal .speed-control {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
}

.hsr-modal .speed-control label {
    font-size: 0.75rem;
    color: #9e9e9e;
}

.hsr-modal .speed-control input[type="range"] {
    flex: 1;
    -webkit-appearance: none;
    height: 5px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
}

.hsr-modal .speed-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    background: var(--primary);
    border-radius: 50%;
    cursor: pointer;
}

.hsr-modal #speedLabel {
    font-size: 0.8rem;
    color: var(--primary);
    font-weight: 600;
    min-width: 25px;
}

/* Current Step Display */
.hsr-modal .current-step-display {
    display: flex;
    align-items: center;
    gap: 12px;
}

.hsr-modal .step-number {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    font-weight: 700;
    color: white;
    flex-shrink: 0;
}

.hsr-modal .step-title-lg {
    font-size: 0.95rem;
    font-weight: 600;
    color: white;
}

.hsr-modal .step-desc-lg {
    font-size: 0.75rem;
    color: #9e9e9e;
}

/* Pipeline Visual */
.hsr-modal .pipeline-visual {
    display: flex;
    align-items: center;
    gap: 5px;
}

.hsr-modal .pipe-node {
    flex: 1;
    text-align: center;
}

.hsr-modal .pipe-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: 700;
    color: #666;
    margin: 0 auto 4px;
    transition: all 0.3s ease;
}

.hsr-modal .pipe-circle.temporal { border-color: #ff9800; color: #ff9800; }
.hsr-modal .pipe-circle.causal { border-color: #2196f3; color: #2196f3; }
.hsr-modal .pipe-circle.capacity { border-color: #9c27b0; color: #9c27b0; }
.hsr-modal .pipe-circle.physical { border-color: #f44336; color: #f44336; }

.hsr-modal .pipe-node.active .pipe-circle {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-color: #667eea;
    color: white;
    transform: scale(1.1);
}

.hsr-modal .pipe-node.completed .pipe-circle {
    background: #4caf50;
    border-color: #4caf50;
    color: white;
}

.hsr-modal .pipe-label {
    font-size: 0.65rem;
    color: #666;
}

.hsr-modal .pipe-value {
    font-size: 0.6rem;
    color: #f44336;
}

.hsr-modal .pipe-node.active .pipe-label,
.hsr-modal .pipe-node.completed .pipe-label {
    color: var(--light);
}

.hsr-modal .pipe-connector {
    width: 15px;
    height: 2px;
    background: rgba(255, 255, 255, 0.2);
    margin-top: -15px;
}

/* Metrics Grid */
.hsr-modal .metrics-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.hsr-modal .metric-box {
    display: flex;
    gap: 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 10px;
}

.hsr-modal .metric-box.highlight {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.hsr-modal .metric-icon {
    font-size: 1.3rem;
}

.hsr-modal .metric-content {
    flex: 1;
}

.hsr-modal .metric-label {
    font-size: 0.65rem;
    color: #9e9e9e;
    text-transform: uppercase;
}

.hsr-modal .metric-value {
    font-size: 1rem;
    font-weight: 700;
    color: white;
}

.hsr-modal .metric-value.green {
    color: #4caf50;
}

.hsr-modal .metric-bar {
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    margin-top: 5px;
    overflow: hidden;
}

.hsr-modal .metric-fill {
    height: 100%;
    transition: width 0.5s ease;
}

.hsr-modal .metric-fill.space {
    background: linear-gradient(90deg, #4caf50, #8bc34a);
}

.hsr-modal .metric-fill.reduction {
    background: linear-gradient(90deg, #f44336, #ff9800);
}

/* Formula Display */
.hsr-modal .formula-display {
    text-align: center;
}

.hsr-modal .formula-line {
    margin-bottom: 10px;
}

.hsr-modal .formula-label {
    font-size: 0.75rem;
    color: #9e9e9e;
    margin-right: 8px;
}

.hsr-modal .formula-eq {
    font-family: 'Kalam', cursive;
    font-size: 0.9rem;
    color: #ce93d8;
}

.hsr-modal .formula-comparison {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
}

.hsr-modal .formula-before,
.hsr-modal .formula-after {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 8px 12px;
    text-align: center;
}

.hsr-modal .formula-before {
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.hsr-modal .formula-after {
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.hsr-modal .fc-label {
    font-size: 0.65rem;
    color: #9e9e9e;
    margin-bottom: 3px;
}

.hsr-modal .fc-value {
    font-size: 0.75rem;
    color: var(--light);
}

.hsr-modal .fc-gain {
    font-size: 0.8rem;
    font-weight: 600;
    color: #4caf50;
    margin-top: 3px;
}

.hsr-modal .formula-arrow {
    font-size: 1.2rem;
    color: #4caf50;
}

/* Responsive */
@media (max-width: 1200px) {
    .scene[data-scene="20"] .hsr-main-display {
        grid-template-columns: 1fr !important;
    }
    
    .hsr-modal .simulator-layout {
        grid-template-columns: 1fr;
    }
    
    .hsr-modal .simulator-canvas {
        min-height: 350px;
    }
    
    .hsr-modal .metrics-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .scene[data-scene="20"] .diagram-container {
        flex-direction: column !important;
    }
    
    .scene[data-scene="20"] .transform-section {
        transform: rotate(90deg) !important;
    }
    
    .hsr-modal .control-buttons {
        flex-wrap: wrap;
    }
    
    .hsr-modal .pipeline-visual {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .hsr-modal .pipe-connector {
        display: none;
    }
    
    .hsr-modal .formula-comparison {
        flex-direction: column;
    }
    
    .hsr-modal .formula-arrow {
        transform: rotate(90deg);
    }
}

/* Writing animation cursor */
.writing-cursor {
    display: inline-block;
    width: 2px;
    height: 1em;
    background: currentColor;
    animation: cursorBlink 0.8s ease infinite;
    margin-left: 2px;
    vertical-align: text-bottom;
}

@keyframes cursorBlink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

/* Panel visibility toggle button */
.panel-visibility-toggle {
    position: fixed;
    bottom: 20px;
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 25px;
    padding: 8px 15px;
    color: var(--light);
    font-size: 0.8rem;
    cursor: pointer;
    z-index: 200;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.panel-visibility-toggle:hover {
    background: rgba(0, 0, 0, 0.9);
    border-color: var(--primary);
}

.panel-visibility-toggle.left {
    left: 20px;
}

.panel-visibility-toggle.right {
    right: 20px;
}

/* Responsive adjustments for panels */
@media (max-width: 1400px) {
    .handwritten-panel {
        width: 240px;
    }
}

@media (max-width: 1200px) {
    .handwritten-panel {
        width: 220px;
        top: 60px;
        height: calc(100vh - 120px);
    }
    
    .handwritten-note {
        font-size: 0.95rem;
    }
}

@media (max-width: 1024px) {
    .handwritten-panel.left-panel {
        display: none;
    }
    
    .handwritten-panel.right-panel {
        width: 200px;
    }
}

@media (max-width: 768px) {
    .handwritten-panel {
        display: none;
    }
}

/* ============================================
   PANEL CONTROLS & SETTINGS
   ============================================ */

.panel-controls {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 300;
}

.control-group {
    position: relative;
}

.control-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: rgba(20, 20, 35, 0.95);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 25px;
    color: var(--light);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.control-btn:hover {
    background: rgba(30, 30, 50, 0.98);
    border-color: var(--primary);
    transform: translateY(-2px);
}

.control-btn .btn-icon {
    font-size: 1.1rem;
}

.control-btn .btn-label {
    font-weight: 500;
}

/* Suggestion Badge (blinking) */
.suggestion-badge {
    position: absolute;
    top: -35px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #ff9800, #f44336);
    color: white;
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 0.7rem;
    white-space: nowrap;
    animation: suggestionPulse 2s ease-in-out infinite;
    box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
}

.suggestion-badge::after {
    content: '';
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid #f44336;
}

.suggestion-badge.hidden {
    display: none;
}

@keyframes suggestionPulse {
    0%, 100% { 
        transform: translateX(-50%) scale(1);
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
    }
    50% { 
        transform: translateX(-50%) scale(1.05);
        box-shadow: 0 6px 25px rgba(255, 152, 0, 0.6);
    }
}

/* Settings Dropdown */
.settings-dropdown {
    position: absolute;
    bottom: 55px;
    left: 0;
    width: 300px;
    background: rgba(20, 20, 35, 0.98);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(15px);
    animation: dropdownSlideUp 0.3s ease;
}

.settings-dropdown.hidden {
    display: none;
}

@keyframes dropdownSlideUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dropdown-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-weight: 600;
    color: var(--light);
}

.close-dropdown {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: var(--text-muted);
    width: 24px;
    height: 24px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s ease;
}

.close-dropdown:hover {
    background: rgba(244, 67, 54, 0.3);
    color: #f44336;
}

.dropdown-content {
    padding: 15px;
}

.setting-section {
    margin-bottom: 15px;
}

.setting-section:last-child {
    margin-bottom: 0;
}

.section-title {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-muted);
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.setting-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
}

.setting-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 0.85rem;
    color: var(--light);
}

.setting-label input[type="checkbox"] {
    display: none;
}

.setting-label .checkmark {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    position: relative;
    transition: all 0.2s ease;
}

.setting-label input[type="checkbox"]:checked + .checkmark {
    background: var(--primary);
    border-color: var(--primary);
}

.setting-label input[type="checkbox"]:checked + .checkmark::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 0.7rem;
}

.setting-status {
    font-size: 0.7rem;
    padding: 3px 8px;
    border-radius: 10px;
    font-weight: 600;
}

.setting-status.on {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
}

.setting-status.off {
    background: rgba(244, 67, 54, 0.2);
    color: #f44336;
}

.slide-override-select {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    padding: 5px 10px;
    color: var(--light);
    font-size: 0.75rem;
    cursor: pointer;
}

.quick-actions {
    display: flex;
    gap: 10px;
}

.quick-btn {
    flex: 1;
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
}

.quick-btn.enable-all {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
    border: 1px solid rgba(76, 175, 80, 0.4);
}

.quick-btn.enable-all:hover {
    background: rgba(76, 175, 80, 0.3);
}

.quick-btn.disable-all {
    background: rgba(244, 67, 54, 0.2);
    color: #f44336;
    border: 1px solid rgba(244, 67, 54, 0.4);
}

.quick-btn.disable-all:hover {
    background: rgba(244, 67, 54, 0.3);
}

/* ============================================
   CC CONTROLS & CONTAINER
   ============================================ */

.cc-controls {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 300;
}

.cc-btn {
    position: relative;
}

.cc-btn .btn-icon {
    font-weight: 700;
    font-size: 0.9rem;
    padding: 2px 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

.cc-btn.active .btn-icon {
    background: var(--primary);
}

.cc-status {
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 8px;
    font-weight: 600;
}

.cc-status.on {
    background: rgba(76, 175, 80, 0.3);
    color: #4caf50;
}

.cc-status.off {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-muted);
}

/* CC Container */
.cc-container {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    width: 70%;
    max-width: 800px;
    z-index: 250;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.cc-container.hidden {
    display: none;
}

.cc-background {
    background: rgba(0, 0, 0, 0.85);
    border-radius: 10px;
    padding: 15px 25px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.cc-text {
    font-family: 'Segoe UI', -apple-system, sans-serif;
    font-size: 1.2rem;
    color: white;
    text-align: center;
    line-height: 1.5;
    min-height: 1.5em;
}

.cc-text .cc-highlight {
    color: #ffc107;
    font-weight: 600;
}

.cc-text .cc-cursor {
    display: inline-block;
    width: 2px;
    height: 1.2em;
    background: white;
    margin-left: 2px;
    animation: ccCursorBlink 0.8s ease infinite;
    vertical-align: text-bottom;
}

@keyframes ccCursorBlink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

/* CC Settings Dropdown */
.cc-controls {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 300;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 10px;
}

.cc-settings-dropdown {
    background: rgba(20, 20, 35, 0.98);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    padding: 15px;
    min-width: 220px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    animation: dropdownSlideUp 0.2s ease;
}

.cc-settings-dropdown.hidden {
    display: none;
}

.cc-setting-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}

.cc-setting-row:last-child {
    margin-bottom: 0;
}

.cc-setting-label {
    font-size: 0.8rem;
    color: var(--text-muted);
    min-width: 60px;
}

.cc-slider {
    flex: 1;
    height: 4px;
    border-radius: 2px;
    background: rgba(255, 255, 255, 0.2);
    appearance: none;
    cursor: pointer;
}

.cc-slider::-webkit-slider-thumb {
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
}

.cc-opacity-value {
    font-size: 0.75rem;
    color: var(--light);
    min-width: 35px;
    text-align: right;
}

.cc-select {
    flex: 1;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    padding: 5px 8px;
    color: var(--light);
    font-size: 0.75rem;
    cursor: pointer;
}

/* ============================================
   SUGGESTION OVERLAY
   ============================================ */

.suggestion-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 500;
    animation: overlayFadeIn 0.3s ease;
}

.suggestion-overlay.hidden {
    display: none;
}

@keyframes overlayFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.suggestion-content {
    background: linear-gradient(135deg, rgba(30, 30, 50, 0.98), rgba(20, 20, 40, 0.98));
    border: 2px solid rgba(255, 193, 7, 0.4);
    border-radius: 20px;
    padding: 30px 40px;
    text-align: center;
    max-width: 450px;
    animation: suggestionBounce 0.5s ease;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

@keyframes suggestionBounce {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
}

.suggestion-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: 15px;
    animation: iconFloat 2s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.suggestion-message {
    font-size: 1.1rem;
    color: var(--light);
    margin-bottom: 25px;
    display: block;
    line-height: 1.5;
}

.suggestion-message strong {
    color: #ffc107;
}

.suggestion-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
    align-items: center;
}

.suggestion-btn {
    padding: 12px 30px;
    border-radius: 25px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    width: 200px;
}

.suggestion-btn.enable {
    background: linear-gradient(135deg, #4caf50, #2e7d32);
    color: white;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
}

.suggestion-btn.enable:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
}

.suggestion-btn.dismiss {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-muted);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.suggestion-btn.dismiss:hover {
    background: rgba(255, 255, 255, 0.15);
    color: var(--light);
}

.suggestion-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    color: var(--text-muted);
    cursor: pointer;
    margin-top: 10px;
}

.suggestion-checkbox input {
    accent-color: var(--primary);
}

/* Blinking settings button when panels disabled */
.control-btn.suggesting {
    animation: settingsBlink 1.5s ease-in-out infinite;
}

@keyframes settingsBlink {
    0%, 100% { 
        border-color: rgba(255, 255, 255, 0.2);
        box-shadow: none;
    }
    50% { 
        border-color: #ffc107;
        box-shadow: 0 0 20px rgba(255, 193, 7, 0.4);
    }
}

/* Responsive */
@media (max-width: 768px) {
    .panel-controls, .cc-controls {
        bottom: 10px;
    }
    
    .settings-dropdown {
        width: 260px;
        left: 10px;
    }
    
    .cc-container {
        width: 90%;
        bottom: 60px;
    }
    
    .cc-text {
        font-size: 1rem;
    }
    
    .suggestion-content {
        margin: 20px;
        padding: 20px;
    }
}

/* ============================================
   STATISTICS HIGHLIGHTING & ZOOM
   ============================================ */
.stat-highlight {
    transition: all 0.3s ease;
    display: inline-block;
    border-radius: 4px;
    padding: 0 4px;
}

.stat-highlight.speaking {
    background: rgba(255, 235, 59, 0.3);
    color: #fff;
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255, 235, 59, 0.5);
    animation: statPulse 0.8s ease infinite;
}

.stat-highlight.zoom-stat.speaking {
    transform: scale(1.15);
    font-weight: 700;
    box-shadow: 0 0 25px rgba(255, 235, 59, 0.7);
}

@keyframes statPulse {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 235, 59, 0.5); }
    50% { box-shadow: 0 0 25px rgba(255, 235, 59, 0.8); }
}

/* ============================================
   NARRATION & AUDIO CONTROLS
   ============================================ */
.narration-indicator {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.85);
    padding: 12px 25px;
    border-radius: 30px;
    z-index: 1001;
    backdrop-filter: blur(10px);
    border: 2px solid var(--purple);
    box-shadow: 0 5px 25px rgba(156, 39, 176, 0.3);
    transition: all 0.3s ease;
}

.narration-indicator.synced { border-color: var(--rq2); box-shadow: 0 5px 25px rgba(76, 175, 80, 0.3); }
.narration-indicator.out-of-sync { border-color: var(--rq3); box-shadow: 0 5px 25px rgba(255, 152, 0, 0.4); animation: pulseWarning 1.5s infinite; }
.narration-indicator.idle { border-color: #555; opacity: 0.7; }

@keyframes pulseWarning {
    0%, 100% { box-shadow: 0 5px 25px rgba(255, 152, 0, 0.4); }
    50% { box-shadow: 0 5px 35px rgba(255, 152, 0, 0.7); }
}

.indicator-content { display: flex; align-items: center; gap: 10px; }
.indicator-icon { font-size: 1.2rem; animation: speakingPulse 1s infinite; }
.narration-indicator.idle .indicator-icon { animation: none; opacity: 0.5; }

@keyframes speakingPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
}

.indicator-label { color: var(--text-muted); font-size: 0.85rem; }
.indicator-scene { background: var(--purple); color: white; padding: 3px 12px; border-radius: 15px; font-weight: 700; font-size: 0.9rem; min-width: 35px; text-align: center; }
.narration-indicator.synced .indicator-scene { background: var(--rq2); }
.narration-indicator.out-of-sync .indicator-scene { background: var(--rq3); }
.narration-indicator.idle .indicator-scene { background: #555; }
.indicator-title { color: var(--light); font-size: 0.9rem; max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.sync-warning { margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255, 152, 0, 0.3); color: var(--rq3); font-size: 0.8rem; text-align: center; }
.sync-warning.hidden { display: none; }
.resync-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 50%; width: 28px; height: 28px; font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease; margin-left: 10px; }
.resync-btn:hover { background: var(--purple); transform: rotate(180deg); }
.sync-link { background: var(--rq3); color: white; border: none; padding: 3px 10px; border-radius: 10px; font-size: 0.75rem; cursor: pointer; }

.audio-controls { 
    position: fixed; 
    bottom: 100px; 
    left: 20px; 
    display: flex; 
    flex-wrap: wrap;
    align-items: center; 
    gap: 8px; 
    z-index: 1000; 
    background: rgba(0,0,0,0.9); 
    padding: 10px 15px; 
    border-radius: 15px; 
    backdrop-filter: blur(10px); 
    max-width: 380px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    cursor: move;
    user-select: none;
    border: 1px solid rgba(255,255,255,0.1);
}
.audio-controls:hover {
    border-color: rgba(156, 39, 176, 0.5);
}
.audio-controls::before {
    content: '⋮⋮';
    position: absolute;
    top: 50%;
    left: 5px;
    transform: translateY(-50%);
    color: rgba(255,255,255,0.3);
    font-size: 10px;
    letter-spacing: -2px;
}
.audio-controls.dragging {
    opacity: 0.8;
    box-shadow: 0 8px 30px rgba(156, 39, 176, 0.4);
}

@media (max-width: 768px) {
    .audio-controls {
        bottom: 100px;
        left: 10px;
        right: auto;
        max-width: calc(100vw - 20px);
        padding: 8px 12px;
        gap: 6px;
    }
}
.audio-btn { 
    background: var(--purple); 
    color: white; 
    border: none; 
    padding: 8px 14px; 
    border-radius: 20px; 
    cursor: pointer; 
    font-size: 13px; 
    transition: all 0.3s ease; 
    white-space: nowrap;
    flex-shrink: 0;
}
.audio-btn:hover { transform: scale(1.05); }
.audio-btn.off { background: #555; }
#speechRate { width: 70px; cursor: pointer; flex-shrink: 0; }
.rate-label { font-size: 11px; color: var(--text-muted); white-space: nowrap; flex-shrink: 0; }

/* Voice Selector Styling */
#voiceSelector {
    max-width: 140px !important;
    font-size: 12px !important;
    padding: 6px 8px !important;
    border-radius: 15px !important;
    background: rgba(255,255,255,0.1) !important;
    color: white !important;
    border: 1px solid rgba(255,255,255,0.2) !important;
    cursor: pointer !important;
    flex-shrink: 0;
}
#voiceSelector option, #voiceSelector optgroup {
    background: #1a1a2e;
    color: white;
}

/* Progress Bar */
.progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: rgba(255,255,255,0.1); z-index: 1000; }
.progress-bar { height: 100%; background: var(--gradient-blue); transition: width 0.5s ease; width: 0%; }

/* Scene Navigation */
.scene-nav { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 8px; z-index: 1000; }
.scene-dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,0.3); cursor: pointer; transition: all 0.3s ease; position: relative; }
.scene-dot:hover { background: rgba(255,255,255,0.6); transform: scale(1.3); }
.scene-dot.active { background: var(--primary); transform: scale(1.4); }
.scene-dot::before { content: attr(data-title); position: absolute; right: 20px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
.scene-dot:hover::before { opacity: 1; }

/* Presentation Container */
.presentation-container { width: 100%; height: 100vh; position: relative; overflow: hidden; }

/* Scene Styles */
.scene { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: flex-start; padding: 80px 60px 120px; opacity: 0; visibility: hidden; transform: translateX(100px); transition: all 0.6s ease; overflow-y: auto; }
.scene.active { opacity: 1; visibility: visible; transform: translateX(0); }
.scene.exit { transform: translateX(-100px); }
.scene-content { max-width: 1200px; width: 100%; }

/* Animations */
.animate-in { opacity: 0; transform: translateY(30px); transition: all 0.8s ease; }
.animate-in.visible { opacity: 1; transform: translateY(0); }
.delay-1 { transition-delay: 0.2s; }
.delay-2 { transition-delay: 0.4s; }
.delay-3 { transition-delay: 0.6s; }
.delay-4 { transition-delay: 0.8s; }
.delay-5 { transition-delay: 1s; }

/* Chapter Badge */
.chapter-badge { display: inline-block; padding: 8px 20px; background: var(--primary); color: white; border-radius: 20px; font-size: 14px; font-weight: 600; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
.chapter-badge.warning { background: var(--red); }
.chapter-badge.success { background: var(--rq2); }
.chapter-badge.purple { background: var(--purple); }
.chapter-badge.glossary { background: var(--teal); }
.chapter-badge.architecture { background: linear-gradient(135deg, var(--primary), var(--purple)); }

.rq-badge { display: inline-block; padding: 10px 25px; border-radius: 25px; font-weight: 600; font-size: 14px; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
.rq-badge.rq1 { background: var(--rq1); color: white; }
.rq-badge.rq2 { background: var(--rq2); color: white; }
.rq-badge.rq3 { background: var(--rq3); color: white; }

.scene-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.scene-subtitle { font-size: 1.2rem; color: var(--text-muted); margin-bottom: 30px; }

/* ============================================
   TITLE & AUTHOR SCENE
   ============================================ */
.title-scene { text-align: center; display: flex; flex-direction: column; align-items: center; padding-top: 30px; }
.title-header { margin-bottom: 30px; }
.title-logo { font-size: 5rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: logoGlow 3s ease-in-out infinite; }
@keyframes logoGlow { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.3); } }
.main-title { font-size: 2rem; color: var(--light); margin: 10px 0; }
.sub-title { font-size: 1.1rem; color: var(--text-muted); line-height: 1.6; }

.author-card { display: flex; gap: 30px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; max-width: 800px; text-align: left; }
.author-photo { flex-shrink: 0; }
.photo-placeholder { width: 100px; height: 100px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 700; color: white; }
.author-info { flex: 1; }
.author-name { font-size: 1.8rem; color: var(--light); margin-bottom: 10px; }
.author-titles { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; }
.title-badge { display: flex; align-items: center; gap: 10px; padding: 8px 15px; background: rgba(255,255,255,0.05); border-radius: 10px; font-size: 0.9rem; }
.title-badge.fellowship { background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.1)); border: 1px solid rgba(255, 215, 0, 0.3); }
.badge-icon { font-size: 1.1rem; }
.author-experience { display: flex; flex-direction: column; gap: 8px; }
.exp-item { display: flex; gap: 15px; align-items: center; font-size: 0.85rem; }
.exp-company { padding: 4px 12px; border-radius: 15px; font-weight: 600; font-size: 0.8rem; }
.exp-company.oracle { background: #c74634; color: white; }
.exp-company.bkash { background: #e2136e; color: white; }
.exp-role { color: var(--text-muted); }
.exp-note { font-size: 0.8rem; color: var(--text-muted); padding-left: 5px; }

.key-results-preview { display: flex; gap: 20px; margin: 25px 0; }
.result-pill { padding: 15px 25px; border-radius: 30px; text-align: center; }
.result-pill.rq1 { background: linear-gradient(135deg, var(--rq1), #1565c0); }
.result-pill.rq2 { background: linear-gradient(135deg, var(--rq2), #2e7d32); }
.result-pill.rq3 { background: linear-gradient(135deg, var(--rq3), #ef6c00); }
.pill-value { display: block; font-size: 1.8rem; font-weight: 700; color: white; }
.pill-label { font-size: 0.85rem; color: rgba(255,255,255,0.9); }

.start-section { margin-top: 20px; }
.narration-hint { color: var(--text-muted); margin-bottom: 15px; }
.start-btn { background: var(--gradient-primary); color: white; border: none; padding: 18px 50px; font-size: 1.2rem; font-weight: 600; border-radius: 30px; cursor: pointer; transition: all 0.3s ease; box-shadow: var(--shadow); }
.start-btn:hover { transform: scale(1.05); }
.start-btn.pulse { animation: pulse 2s infinite; }
@keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); } 50% { box-shadow: 0 0 0 15px rgba(102, 126, 234, 0); } }
.duration-hint { margin-top: 15px; font-size: 0.85rem; color: var(--text-muted); }

/* ============================================
   TERMINOLOGY LEGEND
   ============================================ */
.terminology-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin: 30px 0; }
.term-category { background: rgba(255,255,255,0.02); border-radius: 15px; padding: 20px; }
.category-title { font-size: 1.1rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid; }
.category-title.fl-cat { border-color: var(--rq1); color: var(--rq1); }
.category-title.scfa-cat { border-color: var(--purple); color: var(--purple); }
.category-title.math-cat { border-color: var(--teal); color: var(--teal); }
.category-title.domain-cat { border-color: var(--rq3); color: var(--rq3); }
.term-list { display: flex; flex-direction: column; gap: 12px; }
.term-item { padding: 10px 15px; background: rgba(255,255,255,0.03); border-radius: 10px; transition: all 0.3s ease; }
.term-item:hover { background: rgba(255,255,255,0.08); }
.term-item.speaking { background: rgba(255, 235, 59, 0.15); border-left: 3px solid #ffeb3b; }
.term-name { font-weight: 600; color: var(--light); margin-bottom: 5px; }
.term-def { font-size: 0.85rem; color: var(--text-muted); }
.legend-footer { text-align: center; padding: 20px; background: rgba(255,255,255,0.02); border-radius: 15px; }
.legend-tip { display: flex; align-items: center; justify-content: center; gap: 10px; }
.tip-icon { font-size: 1.2rem; }
.highlight-example { background: rgba(255, 235, 59, 0.3); padding: 2px 8px; border-radius: 4px; }

/* ============================================
   HOLISTIC ARCHITECTURE
   ============================================ */
.holistic-architecture { background: rgba(255,255,255,0.02); border-radius: 20px; padding: 30px; margin: 20px 0; }
.arch-layer { margin: 15px 0; }
.layer-label { text-align: center; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; }
.layer-content { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
.arch-box { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; text-align: center; min-width: 180px; }
.arch-box .box-icon { font-size: 2rem; margin-bottom: 10px; }
.arch-box .box-title { font-weight: 600; color: var(--light); margin-bottom: 10px; }
.arch-box .box-stats { display: flex; flex-direction: column; gap: 5px; font-size: 0.9rem; }
.data-box { border: 2px solid var(--rq1); }
.knowledge-box { border: 2px solid var(--purple); }
.arch-arrow { text-align: center; font-size: 1.5rem; color: var(--primary); margin: 10px 0; animation: arrowBounce 1s infinite; }
@keyframes arrowBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }
.facilities-row { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
.facility-box { background: linear-gradient(135deg, var(--facility-color), rgba(0,0,0,0.3)); padding: 15px; border-radius: 12px; text-align: center; min-width: 80px; }
.facility-box .fac-icon { display: block; font-size: 1.5rem; }
.facility-box .fac-label { display: block; font-weight: 600; font-size: 0.9rem; }
.facility-box .fac-data { display: block; font-size: 0.75rem; opacity: 0.8; }
.process-label { text-align: center; margin-top: 15px; font-size: 0.9rem; color: var(--text-muted); }
.scfa-layer .layer-content { background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(103, 58, 183, 0.1)); border: 2px solid var(--purple); border-radius: 15px; padding: 25px; }
.scfa-core { display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; }
.scfa-step { background: rgba(255,255,255,0.05); padding: 15px 20px; border-radius: 10px; text-align: center; }
.scfa-step .step-num { width: 30px; height: 30px; background: var(--purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: white; margin: 0 auto 10px; }
.scfa-step .step-name { font-weight: 600; color: var(--light); font-size: 0.9rem; }
.scfa-step .step-formula { font-family: 'Times New Roman', serif; font-size: 0.85rem; color: var(--text-muted); margin-top: 5px; }
.scfa-arrow { font-size: 1.5rem; color: var(--purple); }
.rq-outputs { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
.rq-output { flex: 1; min-width: 200px; padding: 20px; border-radius: 15px; text-align: center; }
.rq1-out { background: linear-gradient(135deg, var(--rq1), #1565c0); }
.rq2-out { background: linear-gradient(135deg, var(--rq2), #2e7d32); }
.rq3-out { background: linear-gradient(135deg, var(--rq3), #ef6c00); }
.rq-output .rq-header { font-weight: 700; color: white; margin-bottom: 5px; }
.rq-output .rq-theorem { font-size: 0.85rem; color: rgba(255,255,255,0.8); margin-bottom: 10px; }
.rq-output .rq-result { display: flex; flex-direction: column; gap: 5px; font-size: 0.9rem; color: white; }
.arch-legend { display: flex; justify-content: center; gap: 30px; margin-top: 20px; }
.legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-muted); }
.legend-color { width: 15px; height: 15px; border-radius: 4px; }

/* ============================================
   KNOWLEDGE GRAPH VISUALIZATION (vis.js)
   ============================================ */
.kg-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 10px;
}

.kg-tabs {
    display: flex;
    gap: 5px;
}

.kg-tab {
    padding: 10px 20px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.kg-tab:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--light);
}

.kg-tab.active {
    background: var(--purple);
    border-color: var(--purple);
    color: white;
}

.kg-actions {
    display: flex;
    gap: 8px;
}

.kg-action-btn {
    padding: 8px 15px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85rem;
}

.kg-action-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--light);
}

.kg-action-btn.fullscreen-btn {
    background: rgba(156, 39, 176, 0.2);
    border-color: rgba(156, 39, 176, 0.4);
}

.kg-action-btn.fullscreen-btn:hover {
    background: var(--purple);
    color: white;
}

/* Fullscreen Mode */
.kg-main-container.fullscreen {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    z-index: 9999 !important;
    background: #0f0f1a !important;
    margin: 0 !important;
    padding: 20px !important;
    border-radius: 0 !important;
    display: flex !important;
    flex-direction: row !important;
}

.kg-main-container.fullscreen .kg-canvas {
    flex: 1 !important;
    height: calc(100vh - 40px) !important;
    min-height: calc(100vh - 40px) !important;
}

.kg-main-container.fullscreen .kg-side-panel {
    width: 280px !important;
    max-height: calc(100vh - 40px) !important;
    overflow-y: auto !important;
}

/* Fullscreen exit button */
.fullscreen-exit-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    padding: 12px 20px;
    background: rgba(244, 67, 54, 0.9);
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    display: none;
}

.fullscreen-exit-btn:hover {
    background: #f44336;
    transform: scale(1.05);
}

.fullscreen-exit-btn.visible {
    display: block;
}

/* Fullscreen controls overlay */
.fullscreen-controls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    display: none;
    gap: 10px;
    padding: 15px 25px;
    background: rgba(0, 0, 0, 0.85);
    border-radius: 15px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.fullscreen-controls.visible {
    display: flex;
}

.fullscreen-controls .kg-action-btn {
    padding: 10px 18px;
    font-size: 0.9rem;
}

.kg-main-container {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.kg-canvas {
    flex: 1;
    height: 400px;
    background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.kg-side-panel {
    width: 250px;
    flex-shrink: 0;
}

.kg-legend, .kg-builder {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.kg-legend h4, .kg-builder h4 {
    color: var(--light);
    font-size: 0.9rem;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.legend-items {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.legend-row {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
}

.legend-line {
    width: 25px;
    height: 3px;
    border-radius: 2px;
    flex-shrink: 0;
}

.legend-line.structural { background: #888; }
.legend-line.causal { background: #ff9800; }
.legend-line.temporal { background: #2196f3; }
.legend-line.constraint { background: #9c27b0; }

.kg-stats-mini {
    display: flex;
    justify-content: space-around;
    margin-top: 15px;
    padding-top: 12px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 0.85rem;
    color: var(--text-muted);
}

.kg-stats-mini strong {
    color: var(--primary);
}

/* Custom Graph Builder */
.kg-input, .kg-select {
    width: 100%;
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    color: var(--light);
    font-size: 0.85rem;
    margin-bottom: 8px;
}

.kg-input::placeholder {
    color: var(--text-muted);
}

.kg-select option {
    background: #1a1a2e;
    color: var(--light);
}

.kg-btn {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
    margin-bottom: 5px;
}

.kg-btn.primary {
    background: var(--purple);
    color: white;
}

.kg-btn.primary:hover {
    background: #7b1fa2;
}

.kg-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-muted);
}

.kg-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    color: var(--light);
}

.kg-builder-actions {
    display: flex;
    gap: 8px;
    margin-top: 15px;
}

.kg-builder-actions .kg-btn {
    flex: 1;
}

/* Constraint Derivation Cards */
.constraint-derivation {
    margin-top: 20px;
}

.constraint-derivation h3 {
    text-align: center;
    color: var(--light);
    font-size: 1.1rem;
    margin-bottom: 15px;
}

.derivation-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}

.derivation-card {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    cursor: pointer;
    transition: all 0.3s ease;
}

.derivation-card:hover {
    transform: translateY(-3px);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.deriv-header {
    font-size: 0.85rem;
    font-weight: 600;
    padding: 5px 10px;
    border-radius: 6px;
    margin-bottom: 10px;
    display: inline-block;
}

.deriv-header.temporal { background: rgba(33, 150, 243, 0.2); color: #2196f3; }
.deriv-header.causal { background: rgba(255, 152, 0, 0.2); color: #ff9800; }
.deriv-header.capacity { background: rgba(0, 150, 136, 0.2); color: #009688; }
.deriv-header.physical { background: rgba(156, 39, 176, 0.2); color: #9c27b0; }

.deriv-path {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 8px;
    font-family: monospace;
}

.deriv-rule {
    font-family: 'Times New Roman', serif;
    font-size: 1rem;
    color: var(--light);
    margin-bottom: 5px;
}

.deriv-meaning {
    font-size: 0.75rem;
    color: var(--text-muted);
    font-style: italic;
}

/* KG Summary Stats */
.kg-summary {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 20px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 15px;
}

.summary-stat {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}

.summary-icon {
    font-size: 1.5rem;
}

.summary-value {
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--primary);
}

.summary-label {
    font-size: 0.8rem;
    color: var(--text-muted);
}

/* Responsive */
@media (max-width: 1024px) {
    .kg-main-container {
        flex-direction: column;
    }
    
    .kg-side-panel {
        width: 100%;
    }
    
    .derivation-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 600px) {
    .kg-tabs {
        flex-direction: column;
        width: 100%;
    }
    
    .kg-tab {
        width: 100%;
        text-align: center;
    }
    
    .derivation-grid {
        grid-template-columns: 1fr;
    }
    
    .kg-summary {
        flex-wrap: wrap;
        gap: 20px;
    }
    
    .kg-canvas {
        height: 300px;
    }
}

/* ============================================
   STORY & CONTENT ELEMENTS
   ============================================ */
.story-narrator { display: flex; gap: 20px; background: rgba(255,255,255,0.03); border-left: 4px solid var(--primary); padding: 25px; border-radius: 0 15px 15px 0; margin: 20px 0; }
.narrator-icon { font-size: 2rem; flex-shrink: 0; }
.narrator-text p { margin-bottom: 15px; }
.narrator-text p:last-child { margin-bottom: 0; }

.highlight-blue { color: var(--rq1); font-weight: 600; }
.highlight-green { color: var(--rq2); font-weight: 600; }
.highlight-orange { color: var(--rq3); font-weight: 600; }
.highlight-purple { color: var(--purple); font-weight: 600; }
.highlight-red { color: var(--red); font-weight: 600; }
.highlight-text { font-size: 1.2rem; }

/* Facility Map */
.facility-map { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin: 30px 0; }
.facility { background: linear-gradient(135deg, var(--color, var(--rq1)), rgba(0,0,0,0.3)); padding: 20px; border-radius: 15px; text-align: center; min-width: 130px; box-shadow: var(--shadow); transform: translateY(30px); opacity: 0; transition: all 0.6s ease; }
.facility.visible { transform: translateY(0); opacity: 1; }
.facility-icon { font-size: 2.5rem; margin-bottom: 10px; }
.facility-name { font-weight: 600; margin-bottom: 5px; }
.facility-data { font-size: 0.9rem; opacity: 0.9; }
.total-badge { text-align: center; font-size: 1.2rem; padding: 15px 30px; background: var(--gradient-primary); border-radius: 30px; display: inline-block; margin-top: 20px; }

/* Problem Cards */
.problem-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 30px 0; }
.problem-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; transform: translateY(30px); opacity: 0; transition: all 0.6s ease; }
.problem-card.visible { transform: translateY(0); opacity: 1; }
.problem-icon { font-size: 2.5rem; margin-bottom: 15px; }
.problem-card h3 { color: var(--light); margin-bottom: 10px; font-size: 1.2rem; }
.problem-card p { color: var(--text-muted); font-size: 0.95rem; }

/* FL Flow Diagram */
.fl-flow-diagram { margin-top: 30px; padding: 25px; background: rgba(255,255,255,0.02); border-radius: 20px; }
.diagram-title { text-align: center; font-size: 1rem; color: var(--text-muted); margin-bottom: 20px; }
.fl-flow { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; }
.fl-step { text-align: center; }
.step-box { background: var(--primary); color: white; padding: 12px 20px; border-radius: 10px; font-weight: 600; }
.fl-step.problem .step-box { background: var(--red); }
.problem-label { font-size: 0.8rem; color: var(--red); margin-top: 5px; }
.fl-arrow { font-size: 1.3rem; color: var(--primary); }

/* Insight Box */
.insight-box { display: flex; gap: 25px; background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(103, 58, 183, 0.1)); border: 2px solid var(--purple); padding: 30px; border-radius: 20px; margin: 30px 0; }
.insight-icon { font-size: 3rem; flex-shrink: 0; }
.insight-question { font-size: 1.2rem; margin-bottom: 15px; }
.insight-list { list-style: none; padding-left: 0; }
.insight-list li { padding: 10px 0; padding-left: 10px; opacity: 0; transform: translateX(-20px); transition: all 0.5s ease; }
.insight-list li.visible { opacity: 1; transform: translateX(0); }

/* Knowledge Sources */
.knowledge-sources { margin: 30px 0; }
.knowledge-sources h3 { text-align: center; margin-bottom: 25px; color: var(--light); }
.sources-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 25px; }
.source-card { background: rgba(255,255,255,0.03); border-radius: 15px; overflow: hidden; transform: scale(0.9); opacity: 0; transition: all 0.5s ease; }
.source-card.visible { transform: scale(1); opacity: 1; }
.source-header { padding: 12px; text-align: center; font-weight: 700; color: white; }
.source-header.isa95 { background: var(--rq1); }
.source-header.mason { background: var(--rq2); }
.source-header.nist { background: var(--rq3); }
.source-header.schema { background: var(--purple); }
.source-stats { padding: 15px; text-align: center; }
.source-number { font-size: 1.8rem; font-weight: 700; color: var(--light); }
.source-label { font-size: 0.8rem; color: var(--text-muted); }
.source-desc { padding: 0 12px 12px; font-size: 0.8rem; color: var(--text-muted); text-align: center; }
.total-knowledge { display: flex; justify-content: center; gap: 50px; padding: 25px; background: var(--gradient-primary); border-radius: 15px; }
.total-item { text-align: center; }
.total-number { display: block; font-size: 1.8rem; font-weight: 700; color: white; }
.total-label { font-size: 0.85rem; color: rgba(255,255,255,0.9); }

/* ============================================
   ALGORITHM VISUAL
   ============================================ */
.algorithm-visual { margin: 30px 0; }
.algo-steps { display: flex; flex-direction: column; gap: 15px; }
.algo-step { display: flex; gap: 20px; padding: 25px; background: rgba(255,255,255,0.03); border-radius: 15px; border-left: 4px solid var(--primary); opacity: 0; transform: translateX(-30px); transition: all 0.6s ease; }
.algo-step.visible { opacity: 1; transform: translateX(0); }
.algo-step.highlight-step { background: rgba(76, 175, 80, 0.1); border-left-color: var(--rq2); }
.step-number { width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; font-weight: 700; color: white; flex-shrink: 0; }
.step-number.blue { background: var(--rq1); }
.step-number.green { background: var(--rq2); }
.step-number.purple { background: var(--purple); }
.step-number.orange { background: var(--rq3); }
.step-content { flex: 1; }
.step-content h4 { font-size: 1.2rem; color: var(--light); margin-bottom: 8px; }
.new-badge { background: var(--rq2); color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; margin-left: 10px; vertical-align: middle; }
.constraint-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; }
.constraint-box { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 10px; text-align: center; font-size: 0.85rem; }
.constraint-box.temporal { border-top: 3px solid var(--rq1); }
.constraint-box.causal { border-top: 3px solid var(--rq2); }
.constraint-box.capacity { border-top: 3px solid var(--rq3); }
.constraint-box.physical { border-top: 3px solid var(--purple); }
.step-output { font-size: 0.9rem; color: var(--text-muted); margin-top: 10px; }
.key-insight { background: rgba(255, 152, 0, 0.15); border-left: 3px solid var(--rq3); padding: 10px 15px; border-radius: 0 8px 8px 0; margin-top: 15px; }
.equation-box { background: rgba(0, 150, 136, 0.1); border: 1px solid var(--teal); padding: 15px; border-radius: 10px; margin: 10px 0; text-align: center; }
.equation-box .math { font-family: 'Times New Roman', serif; font-size: 1.2rem; color: var(--light); }
.result-note { padding: 10px 15px; border-radius: 8px; margin-top: 10px; font-size: 0.9rem; }
.result-note.success { background: rgba(76, 175, 80, 0.15); border-left: 3px solid var(--rq2); }
.step-visual-inline { background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 8px; font-size: 0.9rem; color: var(--text-muted); margin-top: 10px; text-align: center; }

/* ============================================
   ANIMATED EQUATIONS
   ============================================ */
.theorem-container { background: rgba(33, 150, 243, 0.08); border: 2px solid var(--rq1); border-radius: 20px; padding: 25px; margin: 25px 0; }
.theorem-container.green { background: rgba(76, 175, 80, 0.08); border-color: var(--rq2); }
.theorem-container.orange { background: rgba(255, 152, 0, 0.08); border-color: var(--rq3); }
.theorem-header-box { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
.theorem-badge { background: var(--rq1); color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.85rem; font-weight: 700; }
.theorem-badge.green { background: var(--rq2); }
.theorem-badge.orange { background: var(--rq3); }
.theorem-name { font-size: 1.1rem; color: var(--light); }

.animated-equation { margin: 20px 0; }
.equation-display { display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 15px; }
.equation-display.horizontal { flex-wrap: nowrap; }
.eq-component { background: rgba(255,255,255,0.05); padding: 15px 20px; border-radius: 12px; text-align: center; transition: all 0.5s ease; opacity: 0.6; transform: scale(0.95); }
.eq-component.active { opacity: 1; transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 235, 59, 0.4); background: rgba(255, 235, 59, 0.15); }
.eq-component .component-value { font-family: 'Times New Roman', serif; font-size: 1.5rem; color: var(--light); font-weight: 600; }
.eq-component .component-label { font-size: 0.8rem; color: var(--text-muted); margin-top: 5px; }
.eq-component .component-detail { font-size: 0.75rem; color: var(--primary); margin-top: 3px; }
.eq-component.standard-term { border: 2px solid var(--rq1); }
.eq-component.penalty-term { border: 2px solid var(--red); }
.eq-component.base-term { border: 2px solid var(--rq2); }
.eq-component.overhead-term { border: 2px solid var(--teal); }
.eq-component.highlight-component { border: 2px solid var(--rq2); }
.eq-operator { font-size: 2rem; color: var(--text-muted); opacity: 0.6; transition: opacity 0.3s ease; }
.eq-operator.active { opacity: 1; }
.equation-result { text-align: center; margin-top: 15px; font-size: 1.1rem; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 10px; }

.param-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
.param-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; text-align: center; transition: all 0.3s ease; }
.param-card.highlight { background: rgba(255, 152, 0, 0.1); border: 1px solid var(--rq3); }
.param-card.active { transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 235, 59, 0.3); }
.param-card .param-symbol { font-size: 1.8rem; font-family: 'Times New Roman', serif; font-style: italic; color: var(--light); }
.param-card .param-name { font-size: 0.85rem; color: var(--text-muted); margin: 5px 0; }
.param-card .param-insight { font-size: 0.8rem; color: var(--primary); }

/* Equation Breakdown Animation */
.equation-breakdown { margin: 15px 0; }
.equation-full { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; font-family: 'Times New Roman', serif; font-size: 1.3rem; }
.eq-part { padding: 5px 10px; border-radius: 5px; transition: all 0.3s ease; }
.eq-part.active { background: rgba(255, 235, 59, 0.3); transform: scale(1.1); }
.equation-explains { display: flex; flex-direction: column; gap: 5px; margin-top: 10px; }
.eq-explain { font-size: 0.85rem; color: var(--text-muted); padding: 5px 10px; border-radius: 5px; opacity: 0; transform: translateY(10px); transition: all 0.3s ease; }
.eq-explain.visible { opacity: 1; transform: translateY(0); }

/* Space Visualization */
.space-visualization { margin: 30px 0; }
.space-compare { display: flex; align-items: center; justify-content: center; gap: 40px; }
.space-box { text-align: center; }
.space-circle { border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
.space-circle.large { width: 160px; height: 160px; background: linear-gradient(135deg, var(--red), #c62828); }
.space-circle.small { width: 100px; height: 100px; background: linear-gradient(135deg, var(--rq2), #2e7d32); }
.space-value { font-size: 1.8rem; font-weight: 700; }
.space-unit { font-size: 0.85rem; opacity: 0.9; }
.space-label { font-weight: 600; color: var(--light); margin-top: 10px; }
.space-desc { font-size: 0.85rem; color: var(--text-muted); }
.space-arrow-container { display: flex; flex-direction: column; align-items: center; }
.reduction-arrow { text-align: center; }
.arrow-body { width: 80px; height: 3px; background: var(--purple); position: relative; }
.arrow-body::after { content: "→"; position: absolute; right: -15px; top: -12px; font-size: 1.5rem; color: var(--purple); }
.arrow-label { font-size: 0.9rem; color: var(--purple); margin-top: 10px; }

/* ============================================
   RESULTS TABLES
   ============================================ */
.results-table-container { overflow-x: auto; margin: 25px 0; }
.results-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; background: rgba(255,255,255,0.03); border-radius: 15px; overflow: hidden; }
.results-table th { background: var(--rq1); color: white; padding: 15px 20px; text-align: left; font-weight: 600; }
.results-table.green th { background: var(--rq2); }
.results-table.orange th { background: var(--rq3); }
.results-table td { padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); }
.results-table tr.animate-row { opacity: 0; transform: translateX(-20px); transition: all 0.5s ease; }
.results-table tr.animate-row.visible { opacity: 1; transform: translateX(0); }
.results-table tr.highlight-row { background: rgba(255,255,255,0.05); }
.results-table .scfa { color: var(--rq2); font-weight: 600; }
.results-table .fedavg { color: var(--text-muted); }
.results-table .speedup, .results-table .improvement { color: var(--rq2); font-weight: 600; }
.results-table .speedup.best, .results-table .improvement.best { font-size: 1.05rem; }
.priority { padding: 3px 10px; border-radius: 10px; font-size: 0.75rem; font-weight: 600; }
.priority.critical { background: var(--red); color: white; }
.priority.high { background: var(--rq3); color: white; }
.priority.medium { background: var(--teal); color: white; }

/* Metrics Summary */
.metrics-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 25px 0; }
.metrics-summary.green .metric-box { border-left-color: var(--rq2); }
.metric-box { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 15px; text-align: center; border-left: 4px solid var(--rq1); }
.metric-value { font-size: 1.6rem; font-weight: 700; color: var(--light); }
.metric-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 5px; }

/* Insight Callout */
.insight-callout { display: flex; gap: 20px; padding: 20px; background: rgba(255,255,255,0.03); border-radius: 15px; border-left: 4px solid var(--primary); margin: 20px 0; }
.callout-icon { font-size: 2rem; }
.callout-text h4 { color: var(--light); margin-bottom: 8px; }
.callout-text p { color: var(--text-muted); }

/* Key Insight Box */
.key-insight-box { display: flex; gap: 20px; padding: 20px; background: rgba(255, 235, 59, 0.1); border: 2px solid #ffc107; border-radius: 15px; margin: 20px 0; }
.key-insight-box .insight-icon { font-size: 2rem; }
.key-insight-box .insight-text { font-size: 1rem; line-height: 1.6; }

/* Analogy Box */
.analogy-box { display: flex; gap: 20px; padding: 20px; background: rgba(156, 39, 176, 0.1); border: 1px solid var(--purple); border-radius: 15px; margin: 20px 0; }
.analogy-icon { font-size: 2.5rem; }
.analogy-content h4 { color: var(--light); margin-bottom: 10px; }
.analogy-content p { color: var(--text-muted); }

/* Threshold Visualization */
.threshold-visualization { margin: 25px 0; }
.threshold-visualization h4 { text-align: center; margin-bottom: 15px; color: var(--light); }
.threshold-bar { display: flex; height: 50px; border-radius: 10px; overflow: hidden; position: relative; }
.zone { display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-size: 0.8rem; }
.zone.safe { background: var(--rq2); }
.zone.warning { background: #ffc107; color: #333; }
.zone.danger { background: var(--rq3); }
.zone.critical { background: var(--red); }
.zone-label { font-weight: 700; }
.zone-range { font-size: 0.7rem; opacity: 0.9; }
.threshold-marker { text-align: center; margin-top: 10px; }
.marker-line { display: none; }
.marker-label { font-size: 0.9rem; color: var(--light); }

/* Practical Rule */
.practical-rule { display: flex; gap: 20px; padding: 20px; background: rgba(255, 152, 0, 0.1); border: 2px solid var(--rq3); border-radius: 15px; margin: 20px 0; }
.rule-icon { font-size: 2rem; }
.rule-content h4 { color: var(--light); margin-bottom: 8px; }
.rule-content p { color: var(--text-muted); }

/* Performance Cards */
.performance-cards { margin: 25px 0; }
.performance-cards h4 { text-align: center; margin-bottom: 15px; color: var(--light); }
.perf-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
.perf-card { padding: 20px; border-radius: 15px; text-align: center; color: white; }
.perf-card.safe { background: linear-gradient(135deg, var(--rq2), #2e7d32); }
.perf-card.warning { background: linear-gradient(135deg, #ffc107, #ff9800); color: #333; }
.perf-card.danger { background: linear-gradient(135deg, var(--rq3), #ef6c00); }
.perf-card.critical { background: linear-gradient(135deg, var(--red), #c62828); }
.perf-range { font-size: 0.9rem; margin-bottom: 8px; }
.perf-score { font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
.perf-pct { font-size: 0.8rem; opacity: 0.9; }

/* ============================================
   RQ CARDS
   ============================================ */
.rq-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin: 30px 0; }
.rq-card { background: rgba(255,255,255,0.03); border-radius: 20px; padding: 25px; cursor: pointer; transition: all 0.4s ease; border: 2px solid transparent; opacity: 0; transform: translateY(30px); }
.rq-card.visible { opacity: 1; transform: translateY(0); }
.rq-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
.rq-card.rq1 { border-color: var(--rq1); }
.rq-card.rq2 { border-color: var(--rq2); }
.rq-card.rq3 { border-color: var(--rq3); }
.rq-card.rq1:hover { background: rgba(33, 150, 243, 0.1); }
.rq-card.rq2:hover { background: rgba(76, 175, 80, 0.1); }
.rq-card.rq3:hover { background: rgba(255, 152, 0, 0.1); }
.rq-number { font-size: 0.9rem; font-weight: 700; margin-bottom: 8px; }
.rq-card.rq1 .rq-number { color: var(--rq1); }
.rq-card.rq2 .rq-number { color: var(--rq2); }
.rq-card.rq3 .rq-number { color: var(--rq3); }
.rq-title { font-size: 1.3rem; color: var(--light); margin-bottom: 12px; }
.rq-question { color: var(--text-muted); margin-bottom: 15px; font-size: 0.9rem; }
.rq-answer { background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 10px; margin-bottom: 12px; }
.answer-label { color: var(--text-muted); margin-right: 8px; }
.answer-value { font-weight: 600; color: var(--light); }
.rq-cta { color: var(--text-muted); font-size: 0.85rem; }
.rq-card:hover .rq-cta { color: var(--light); }

/* Answer Reveal */
.answer-reveal { margin: 25px 0; }
.answer-box { display: flex; align-items: center; gap: 20px; padding: 25px 35px; border-radius: 15px; background: linear-gradient(135deg, var(--rq1), #1565c0); }
.answer-box.green { background: linear-gradient(135deg, var(--rq2), #2e7d32); }
.answer-box.orange { background: linear-gradient(135deg, var(--rq3), #ef6c00); }
.answer-icon { font-size: 2.5rem; color: white; }
.answer-main { font-size: 1.4rem; font-weight: 700; color: white; margin-bottom: 5px; }
.answer-detail { color: rgba(255,255,255,0.9); }

/* Architecture Diagram */
.architecture-diagram { margin: 25px 0; text-align: center; }
.architecture-diagram h3 { margin-bottom: 15px; color: var(--light); }
.arch-image { max-width: 100%; border-radius: 15px; box-shadow: var(--shadow); }

/* ============================================
   SUMMARY & CONCLUSION
   ============================================ */
.results-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin: 30px 0; }
.summary-card { padding: 30px; border-radius: 20px; text-align: center; color: white; opacity: 0; transform: rotateY(90deg); transition: all 0.8s ease; }
.summary-card.visible { opacity: 1; transform: rotateY(0); }
.summary-card.rq1 { background: linear-gradient(135deg, var(--rq1), #1565c0); }
.summary-card.rq2 { background: linear-gradient(135deg, var(--rq2), #2e7d32); }
.summary-card.rq3 { background: linear-gradient(135deg, var(--rq3), #ef6c00); }
.summary-rq { font-size: 0.85rem; opacity: 0.9; margin-bottom: 8px; }
.summary-number { font-size: 3rem; font-weight: 700; margin-bottom: 8px; }
.summary-label { font-size: 1rem; font-weight: 600; margin-bottom: 8px; }
.summary-detail { font-size: 0.85rem; opacity: 0.9; margin-bottom: 8px; }
.summary-theory { font-size: 0.8rem; opacity: 0.8; background: rgba(0,0,0,0.2); padding: 5px 10px; border-radius: 10px; }

.validation-banner { display: flex; align-items: center; justify-content: center; gap: 15px; padding: 20px; background: var(--gradient-primary); border-radius: 15px; margin: 25px 0; }
.validation-icon { font-size: 2rem; color: white; }
.validation-text { font-size: 1.1rem; color: white; font-weight: 600; }

.contributions-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin: 25px 0; }
.contribution-card { background: rgba(255,255,255,0.03); padding: 25px; border-radius: 15px; }
.contribution-card h4 { color: var(--light); margin-bottom: 15px; }
.contribution-card ul { list-style: none; padding: 0; }
.contribution-card li { padding: 8px 0; padding-left: 25px; position: relative; color: var(--text-muted); }
.contribution-card li::before { content: "→"; position: absolute; left: 0; color: var(--primary); }

/* Domains Grid */
.domains-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin: 30px 0; }
.domain-card { background: rgba(255,255,255,0.03); border-radius: 20px; padding: 30px; text-align: center; opacity: 0; transform: translateY(30px); transition: all 0.6s ease; }
.domain-card.visible { opacity: 1; transform: translateY(0); }
.domain-icon { font-size: 3rem; margin-bottom: 15px; }
.domain-name { font-size: 1.3rem; font-weight: 600; color: var(--light); margin-bottom: 15px; }
.domain-constraints { display: flex; flex-direction: column; gap: 8px; }
.domain-constraints span { background: rgba(255,255,255,0.05); padding: 5px 15px; border-radius: 15px; font-size: 0.85rem; color: var(--text-muted); }

.key-message { display: flex; gap: 20px; padding: 25px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border: 2px solid var(--purple); border-radius: 20px; margin: 25px 0; align-items: center; }
.message-icon { font-size: 2.5rem; }
.message-text { font-size: 1.2rem; color: var(--light); }

/* Conclusion Scene */
.conclusion-scene { text-align: center; }
.closing-intro { font-size: 1.1rem; color: var(--text-muted); margin-bottom: 20px; }
.benefit-list { display: flex; flex-direction: column; gap: 15px; max-width: 600px; margin: 0 auto 30px; }
.benefit-item { display: flex; align-items: center; gap: 15px; padding: 15px 25px; background: rgba(255,255,255,0.03); border-radius: 15px; text-align: left; opacity: 0; transform: translateX(-30px); transition: all 0.5s ease; }
.benefit-item.visible { opacity: 1; transform: translateX(0); }
.benefit-icon { font-size: 1.5rem; }
.final-message { margin: 30px 0; }
.big-statement { font-size: 1.4rem; color: var(--light); line-height: 1.8; }
.open-science { background: rgba(255,255,255,0.03); padding: 30px; border-radius: 20px; margin: 30px auto; max-width: 600px; }
.open-science h4 { color: var(--light); margin-bottom: 20px; }
.open-stats { display: flex; justify-content: center; gap: 50px; margin-bottom: 15px; }
.open-stat { text-align: center; }
.stat-value { display: block; font-size: 1.8rem; font-weight: 700; color: var(--primary); }
.open-stat .stat-label { font-size: 0.85rem; color: var(--text-muted); }
.open-note { color: var(--text-muted); font-size: 0.9rem; }
.author-footer { margin-top: 30px; }
.footer-name { font-size: 1.5rem; font-weight: 700; color: var(--light); }
.footer-title { color: var(--primary); font-size: 0.95rem; margin-top: 5px; }
.footer-affiliation { color: var(--text-muted); font-size: 0.9rem; }
.questions-prompt { margin-top: 30px; }
.questions-icon { font-size: 3rem; margin-bottom: 10px; }
.questions-text { font-size: 2rem; font-weight: 700; color: var(--light); }

/* Navigation Controls */
.nav-controls { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 1000; background: rgba(0,0,0,0.8); padding: 15px 25px; border-radius: 40px; backdrop-filter: blur(10px); box-shadow: var(--shadow); }
.nav-btn { padding: 12px 25px; border: none; border-radius: 25px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
.nav-btn.prev { background: #555; color: white; }
.nav-btn.pause { background: var(--purple); color: white; }
.nav-btn.next { background: var(--primary); color: white; }
.nav-btn:hover { transform: scale(1.05); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

/* ===== DATA HETEROGENEITY SECTION (Scene 11-12) ===== */

/* Definition Box */
.heterogeneity-definition {
    background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(0, 188, 212, 0.05));
    border: 2px solid rgba(33, 150, 243, 0.4);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.def-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.def-icon {
    font-size: 1.3rem;
}

.def-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.def-content {
    padding: 20px;
}

.def-main {
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 15px;
}

.def-term {
    font-weight: 700;
    color: #2196f3;
}

.def-colon {
    margin: 0 8px;
    color: var(--text-muted);
}

.def-text {
    color: var(--light);
}

.def-formula {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 15px 20px;
}

.formula-box {
    font-family: 'Consolas', monospace;
    font-size: 1.2rem;
    color: #4caf50;
    text-align: center;
    margin-bottom: 10px;
}

.formula-decomposition {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-size: 0.85rem;
}

.decomp-label {
    color: var(--text-muted);
}

.decomp-formula {
    font-family: 'Consolas', monospace;
    color: #64b5f6;
}

/* Taxonomy Grid */
.heterogeneity-taxonomy {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.tax-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.tax-icon {
    font-size: 1.3rem;
}

.tax-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.tax-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    padding: 20px;
}

.het-type {
    background: rgba(255, 255, 255, 0.02);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.het-type:hover {
    border-color: var(--primary);
    transform: translateY(-3px);
}

.type-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.type-header.feature-skew { background: linear-gradient(135deg, rgba(33, 150, 243, 0.2), transparent); }
.type-header.label-skew { background: linear-gradient(135deg, rgba(255, 152, 0, 0.2), transparent); }
.type-header.concept-drift { background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), transparent); }
.type-header.quantity-skew { background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), transparent); }

.type-num {
    font-size: 0.7rem;
    font-weight: 600;
    background: rgba(255, 255, 255, 0.1);
    padding: 3px 10px;
    border-radius: 10px;
    color: var(--text-muted);
}

.type-name {
    font-weight: 600;
    color: var(--light);
    font-size: 0.9rem;
}

.type-body {
    padding: 15px;
}

.type-formula {
    font-family: 'Consolas', monospace;
    font-size: 0.8rem;
    color: #81c784;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px 12px;
    border-radius: 6px;
    margin-bottom: 12px;
    text-align: center;
}

.type-example {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    padding: 12px;
}

.example-header {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 10px;
}

.example-visual {
    min-height: 80px;
    margin-bottom: 10px;
}

/* Feature Example */
.feature-example {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

.facility-data {
    flex: 1;
    text-align: center;
    padding: 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
}

.fac-flag {
    font-size: 1.5rem;
    display: block;
    margin-bottom: 5px;
}

.fac-name {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.sensor-readings {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.reading {
    font-size: 0.7rem;
    color: var(--light);
    background: rgba(255, 255, 255, 0.05);
    padding: 3px 8px;
    border-radius: 4px;
}

.reading.highlight-diff {
    background: rgba(255, 152, 0, 0.2);
    color: #ff9800;
    font-weight: 600;
}

.vs-divider {
    font-size: 1.5rem;
    color: #f44336;
    font-weight: 700;
}

/* Label Example */
.label-example {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.label-dist {
    display: flex;
    align-items: center;
    gap: 10px;
}

.dist-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    min-width: 90px;
}

.dist-bar {
    flex: 1;
    height: 24px;
    display: flex;
    border-radius: 4px;
    overflow: hidden;
}

.bar-segment {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6rem;
    font-weight: 600;
    color: white;
}

.bar-segment.healthy {
    background: #4caf50;
}

.bar-segment.failure {
    background: #f44336;
}

/* Concept Example */
.concept-example {
    padding: 10px;
}

.concept-scenario {
    text-align: center;
}

.scenario-input {
    background: rgba(33, 150, 243, 0.2);
    padding: 8px 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    display: inline-block;
}

.input-label {
    font-size: 0.7rem;
    color: var(--text-muted);
}

.input-val {
    font-size: 0.85rem;
    color: #2196f3;
    font-weight: 600;
}

.scenario-outputs {
    display: flex;
    gap: 10px;
}

.output-item {
    flex: 1;
    background: rgba(0, 0, 0, 0.3);
    padding: 10px;
    border-radius: 8px;
    text-align: center;
}

.out-icon {
    font-size: 1.2rem;
    display: block;
}

.out-label {
    font-size: 0.65rem;
    color: var(--text-muted);
    display: block;
    margin-bottom: 5px;
}

.out-result {
    font-size: 0.8rem;
    font-weight: 700;
    display: block;
}

.out-result.danger { color: #f44336; }
.out-result.safe { color: #4caf50; }

.out-reason {
    font-size: 0.6rem;
    color: var(--text-muted);
    margin-top: 3px;
}

/* Quantity Example */
.quantity-example {
    display: flex;
    justify-content: center;
}

.quantity-bars {
    display: flex;
    align-items: flex-end;
    gap: 15px;
    height: 100px;
}

.qty-bar {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 50px;
}

.qty-fill {
    width: 100%;
    background: linear-gradient(to top, #4caf50, #8bc34a);
    border-radius: 4px 4px 0 0;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 5px;
}

.qty-val {
    font-size: 0.65rem;
    font-weight: 600;
    color: white;
}

.qty-label {
    font-size: 0.6rem;
    color: var(--text-muted);
    margin-top: 5px;
    text-align: center;
}

.example-insight {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.75rem;
    color: #4caf50;
    padding: 8px;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 6px;
}

.insight-badge {
    font-weight: 700;
}

/* Heterogeneity Quantification */
.heterogeneity-quantification {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
}

.quant-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.quant-icon {
    font-size: 1.3rem;
}

.quant-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.quant-content {
    padding: 20px;
    display: flex;
    gap: 30px;
    align-items: center;
}

.dirichlet-explanation {
    flex: 2;
}

.dirichlet-formula {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    text-align: center;
}

.formula-label {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.dirichlet-formula .formula-main {
    font-size: 1.5rem;
    color: var(--light);
    margin-bottom: 5px;
}

.formula-note {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.dirichlet-spectrum {
    margin-top: 15px;
}

.spectrum-label {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 10px;
}

.spectrum-bar {
    position: relative;
    height: 80px;
    padding-top: 30px;
}

.spectrum-gradient {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 20px;
    background: linear-gradient(to right, #f44336, #ff9800, #ffc107, #8bc34a, #4caf50);
    border-radius: 10px;
}

.spectrum-point {
    position: absolute;
    bottom: 25px;
    transform: translateX(-50%);
    text-align: center;
}

.point-val {
    display: block;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--light);
}

.point-label {
    font-size: 0.65rem;
    color: var(--text-muted);
    line-height: 1.3;
}

.spectrum-point.extreme .point-val { color: #f44336; }
.spectrum-point.high .point-val { color: #ff9800; }
.spectrum-point.moderate .point-val { color: #ffc107; }
.spectrum-point.low .point-val { color: #8bc34a; }
.spectrum-point.iid .point-val { color: #4caf50; }

.our-experiments {
    flex: 1;
    background: rgba(156, 39, 176, 0.1);
    border: 2px solid rgba(156, 39, 176, 0.3);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
}

.exp-badge {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--purple);
    margin-bottom: 10px;
}

.exp-range {
    font-family: 'Consolas', monospace;
    font-size: 1rem;
    color: var(--light);
    margin-bottom: 8px;
}

.exp-note {
    font-size: 0.75rem;
    color: var(--text-muted);
}

/* Heterogeneity-Constraint Problem */
.het-constraint-problem {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.problem-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(244, 67, 54, 0.15);
    border-bottom: 2px solid #f44336;
}

.problem-icon {
    font-size: 1.3rem;
}

.problem-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.problem-visual {
    padding: 20px;
}

.interaction-diagram {
    display: flex;
    align-items: stretch;
    gap: 10px;
}

.diagram-section {
    flex: 1;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.section-label {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-muted);
    text-align: center;
    margin-bottom: 15px;
}

.diagram-arrow {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0 10px;
}

.arrow-text {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 5px;
}

.arrow-symbol {
    font-size: 1.5rem;
    color: var(--purple);
}

.local-dists {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.local-dist {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
}

.dist-curve {
    width: 60px;
    height: 30px;
    position: relative;
}

.dist-curve.skewed-left {
    background: linear-gradient(to right, rgba(33, 150, 243, 0.8), transparent);
    border-radius: 15px 5px 5px 15px;
}

.dist-curve.skewed-right {
    background: linear-gradient(to left, rgba(255, 152, 0, 0.8), transparent);
    border-radius: 5px 15px 15px 5px;
}

.dist-curve.bimodal {
    background: radial-gradient(ellipse at 25% 50%, rgba(76, 175, 80, 0.8), transparent 50%),
                radial-gradient(ellipse at 75% 50%, rgba(76, 175, 80, 0.8), transparent 50%);
}

.local-dist .dist-label {
    font-family: 'Consolas', monospace;
    font-size: 0.75rem;
    color: var(--text-muted);
}

.model-predictions {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.pred-box {
    padding: 10px;
    border-radius: 8px;
}

.pred-box.invalid-global {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.pred-box.valid-global {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.pred-header {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.pred-item {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    align-items: center;
    margin-bottom: 5px;
}

.pred-label {
    font-size: 0.7rem;
    color: var(--text-muted);
}

.pred-val {
    font-family: 'Consolas', monospace;
    font-size: 0.75rem;
    color: var(--light);
}

.pred-status {
    font-size: 0.7rem;
    font-weight: 600;
}

.pred-status.violation { color: #f44336; }
.pred-status.valid { color: #4caf50; }

.pred-reason {
    font-size: 0.65rem;
    color: var(--text-muted);
    font-style: italic;
}

.constraint-conflict {
    text-align: center;
}

.conflict-scenario {
    padding: 10px;
}

.constraint-rule {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 10px;
    background: rgba(255, 152, 0, 0.1);
    border-radius: 8px;
    margin-bottom: 15px;
}

.rule-icon {
    font-size: 1.2rem;
}

.rule-text {
    font-family: 'Consolas', monospace;
    font-size: 0.85rem;
    color: #ff9800;
}

.conflict-result {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.result-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.8rem;
}

.result-item.violates {
    background: rgba(244, 67, 54, 0.1);
    color: #f44336;
}

.result-item.satisfies {
    background: rgba(76, 175, 80, 0.1);
    color: #4caf50;
}

.status {
    font-weight: 600;
}

/* Impact Analysis */
.impact-analysis {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.analysis-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.analysis-icon {
    font-size: 1.3rem;
}

.analysis-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.analysis-content {
    padding: 20px;
    display: grid;
    grid-template-columns: 1.5fr 1fr;
    gap: 20px;
}

.impact-chart {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    padding: 15px;
}

.chart-container {
    display: grid;
    grid-template-columns: 60px 1fr;
    grid-template-rows: 1fr 60px;
    gap: 10px;
    height: 220px;
}

.chart-y {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.chart-y .axis-title {
    writing-mode: vertical-rl;
    transform: rotate(180deg);
    font-size: 0.75rem;
    color: var(--text-muted);
}

.y-ticks {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
    font-size: 0.65rem;
    color: var(--text-muted);
    text-align: right;
}

.chart-plot {
    position: relative;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.threshold-line {
    position: absolute;
    left: 0;
    right: 0;
    border-top: 2px dashed rgba(255, 152, 0, 0.6);
}

.threshold-label {
    position: absolute;
    right: 10px;
    top: -18px;
    font-size: 0.65rem;
    color: #ff9800;
    background: rgba(0, 0, 0, 0.7);
    padding: 2px 6px;
    border-radius: 3px;
}

.impact-curve {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.data-points {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.data-points .point {
    position: absolute;
}

.point-marker {
    display: block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    transform: translate(-50%, 50%);
}

.point.fedavg .point-marker {
    background: #f44336;
    box-shadow: 0 0 8px rgba(244, 67, 54, 0.5);
}

.point.scfa .point-marker {
    background: #4caf50;
    box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
}

.chart-x {
    grid-column: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.x-ticks {
    display: flex;
    justify-content: space-between;
    width: 100%;
    font-size: 0.6rem;
    color: var(--text-muted);
    text-align: center;
}

.chart-x .axis-title {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 5px;
}

.chart-legend {
    margin-top: 15px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.chart-legend .legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.75rem;
    color: var(--text-muted);
}

.legend-color {
    width: 20px;
    height: 3px;
    border-radius: 2px;
}

.legend-color.fedavg { background: #f44336; }
.legend-color.scfa { background: #4caf50; }

/* Impact Table */
.impact-table {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    padding: 15px;
}

.table-title {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--light);
    margin-bottom: 15px;
    text-align: center;
}

.het-table {
    width: 100%;
}

.het-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 10px;
    padding: 8px 10px;
    border-radius: 6px;
}

.het-row.header {
    background: rgba(0, 0, 0, 0.3);
    font-weight: 600;
    font-size: 0.75rem;
    color: var(--text-muted);
}

.het-row:not(.header) {
    font-size: 0.8rem;
}

.het-row.highlight {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.het-cell {
    text-align: center;
}

.fedavg-val { color: #f44336; }
.scfa-val { color: #4caf50; }
.reduction { color: #2196f3; }
.reduction.best { font-weight: 700; }
.danger { font-weight: 700; }
.safe { font-weight: 700; }

/* SCFA Mitigation */
.scfa-mitigation {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.mitigation-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(76, 175, 80, 0.15);
    border-bottom: 2px solid #4caf50;
}

.mitigation-icon {
    font-size: 1.3rem;
}

.mitigation-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.mitigation-mechanisms {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    padding: 20px;
}

.mechanism-card {
    background: rgba(255, 255, 255, 0.02);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.mechanism-card .mech-num {
    width: 30px;
    height: 30px;
    background: #4caf50;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin-bottom: 12px;
}

.mechanism-card .mech-title {
    font-weight: 600;
    color: var(--light);
    font-size: 0.9rem;
    margin-bottom: 12px;
}

.mechanism-card .mech-visual {
    min-height: 80px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mechanism-card .mech-desc {
    font-size: 0.8rem;
    color: var(--text-muted);
    text-align: center;
}

/* Alignment Demo */
.alignment-demo {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
}

.before-align, .after-align {
    flex: 1;
    text-align: center;
}

.before-align .label, .after-align .label {
    font-size: 0.7rem;
    color: var(--text-muted);
    display: block;
    margin-bottom: 5px;
}

.features {
    position: relative;
    height: 60px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
}

.feat {
    position: absolute;
    font-size: 0.6rem;
    padding: 3px 6px;
    border-radius: 4px;
    transform: translate(-50%, -50%);
}

.features.scattered .feat {
    background: rgba(244, 67, 54, 0.3);
    color: #f44336;
}

.features.aligned .feat {
    background: rgba(76, 175, 80, 0.3);
    color: #4caf50;
}

.align-arrow {
    font-size: 1.2rem;
    color: #4caf50;
}

/* Weighting Demo */
.weighting-demo {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
}

.weight-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border-radius: 6px;
}

.weight-item.high-validity {
    background: rgba(76, 175, 80, 0.1);
}

.weight-item.low-validity {
    background: rgba(244, 67, 54, 0.1);
}

.weight-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    min-width: 50px;
}

.weight-bar {
    height: 12px;
    background: #4caf50;
    border-radius: 6px;
}

.weight-item.low-validity .weight-bar {
    background: #f44336;
}

.weight-effect {
    font-size: 0.7rem;
    color: var(--text-muted);
}

/* Invariant Demo */
.invariant-demo {
    text-align: center;
}

.constraint-universal {
    background: rgba(255, 152, 0, 0.2);
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 10px;
}

.const-text {
    font-family: 'Consolas', monospace;
    font-size: 0.9rem;
    color: #ff9800;
}

.applies-to {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.apply-arrow {
    font-size: 1rem;
    color: var(--purple);
}

.apply-targets {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    justify-content: center;
}

.target {
    font-size: 0.7rem;
    background: rgba(76, 175, 80, 0.1);
    color: #4caf50;
    padding: 3px 8px;
    border-radius: 10px;
}

/* Heterogeneity Theorem */
.het-theorem {
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(103, 58, 183, 0.05));
    border: 2px solid rgba(156, 39, 176, 0.4);
    border-radius: 15px;
    padding: 20px;
}

.het-theorem .theorem-badge {
    display: inline-block;
    background: var(--purple);
    color: white;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 15px;
}

.het-theorem .theorem-content {
    text-align: center;
}

.het-theorem .theorem-statement {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 15px;
}

.het-theorem .theorem-formula {
    font-size: 1.3rem;
    color: var(--light);
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    margin-bottom: 15px;
    font-family: 'Consolas', monospace;
}

.theorem-interpretation {
    display: flex;
    flex-direction: column;
    gap: 10px;
    text-align: left;
}

.interp-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 10px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
}

.interp-icon {
    font-size: 1rem;
}

.interp-text {
    font-size: 0.85rem;
    color: var(--text-muted);
}

/* Responsive for Data Heterogeneity */
@media (max-width: 1200px) {
    .tax-grid {
        grid-template-columns: 1fr;
    }
    
    .analysis-content {
        grid-template-columns: 1fr;
    }
    
    .mitigation-mechanisms {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .quant-content {
        flex-direction: column;
    }
    
    .interaction-diagram {
        flex-direction: column;
    }
    
    .diagram-arrow {
        transform: rotate(90deg);
    }
}

/* ============================================
   ICML REVIEWER RESPONSE SECTIONS
   ============================================ */

/* Badge for ICML Response */
.chapter-badge.technical-deepdive {
    background: linear-gradient(135deg, rgba(233, 30, 99, 0.2), rgba(156, 39, 176, 0.2));
    border-color: #e91e63;
    animation: pulseGlow 2s ease-in-out infinite;
}

@keyframes pulseGlow {
    0%, 100% { box-shadow: 0 0 10px rgba(233, 30, 99, 0.3); }
    50% { box-shadow: 0 0 20px rgba(233, 30, 99, 0.6); }
}

/* ===== KNOWLEDGE GRAPH CONSTRUCTION (Scene 8) ===== */

.kg-construction-pipeline {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
}

.pipeline-phase {
    background: rgba(255, 255, 255, 0.02);
    border-radius: 15px;
    margin-bottom: 15px;
    overflow: hidden;
}

.phase-header {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    border-bottom: 2px solid;
}

.phase-header.source-phase {
    background: linear-gradient(135deg, rgba(33, 150, 243, 0.2), transparent);
    border-color: #2196f3;
}

.phase-header.extraction-phase {
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), transparent);
    border-color: #9c27b0;
}

.phase-header.constraint-phase {
    background: linear-gradient(135deg, rgba(255, 152, 0, 0.2), transparent);
    border-color: #ff9800;
}

.phase-num {
    background: rgba(255, 255, 255, 0.1);
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--light);
}

.phase-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--light);
}

.phase-content {
    padding: 20px;
}

/* Ontology Sources */
.ontology-sources {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
}

.ont-source {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.ont-source:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
}

.ont-icon {
    font-size: 2rem;
    margin-bottom: 10px;
}

.ont-name {
    font-weight: 700;
    color: var(--light);
    font-size: 1rem;
    margin-bottom: 5px;
}

.ont-desc {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 10px;
}

.ont-stats {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 8px;
}

.ont-stat {
    font-size: 0.7rem;
    color: #4caf50;
    background: rgba(76, 175, 80, 0.1);
    padding: 3px 8px;
    border-radius: 10px;
}

.ont-format {
    font-size: 0.65rem;
    color: var(--text-muted);
    font-family: monospace;
}

/* Pipeline Arrow */
.pipeline-arrow {
    display: flex;
    justify-content: center;
    padding: 10px 0;
}

.arrow-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}

.arrow-icon {
    font-size: 1.5rem;
}

.arrow-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    font-family: monospace;
    background: rgba(0, 0, 0, 0.3);
    padding: 4px 12px;
    border-radius: 15px;
}

.animate-pulse {
    animation: arrowPulse 1.5s ease-in-out infinite;
}

@keyframes arrowPulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

/* Extraction Process */
.extraction-process {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

.extraction-step {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid rgba(156, 39, 176, 0.3);
}

.ext-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.ext-icon {
    font-size: 1.2rem;
}

.ext-title {
    font-weight: 600;
    color: var(--light);
    font-size: 0.9rem;
}

.ext-code {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    font-family: 'Consolas', monospace;
    font-size: 0.7rem;
    color: #64b5f6;
}

.ext-code code {
    display: block;
    line-height: 1.6;
}

.ext-output {
    text-align: center;
}

.output-badge {
    display: inline-block;
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

/* Constraint Derivation */
.constraint-derivation {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
}

.derivation-category {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.deriv-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.deriv-header.temporal-deriv { background: rgba(33, 150, 243, 0.15); }
.deriv-header.causal-deriv { background: rgba(255, 152, 0, 0.15); }
.deriv-header.capacity-deriv { background: rgba(76, 175, 80, 0.15); }
.deriv-header.physical-deriv { background: rgba(156, 39, 176, 0.15); }

.deriv-icon {
    font-size: 1.1rem;
}

.deriv-type {
    font-weight: 600;
    color: var(--light);
    font-size: 0.85rem;
    flex: 1;
}

.deriv-count {
    font-size: 0.7rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 3px 10px;
    border-radius: 10px;
    color: var(--text-muted);
}

.deriv-sparql {
    padding: 10px 15px;
    background: rgba(0, 0, 0, 0.3);
}

.deriv-sparql code.sparql {
    display: block;
    font-family: 'Consolas', monospace;
    font-size: 0.65rem;
    color: #81c784;
    line-height: 1.5;
}

.deriv-example {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 15px;
    background: rgba(255, 152, 0, 0.1);
}

.ex-arrow {
    color: #ff9800;
    font-weight: 700;
}

.ex-rule {
    font-family: 'Consolas', monospace;
    font-size: 0.8rem;
    color: #ff9800;
}

/* Academic Insight Box */
.academic-insight {
    background: linear-gradient(135deg, rgba(41, 98, 255, 0.1), rgba(156, 39, 176, 0.1));
    border: 2px solid var(--primary);
    border-radius: 15px;
    overflow: hidden;
}

.insight-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.insight-icon {
    font-size: 1.3rem;
}

.insight-title {
    font-weight: 700;
    color: var(--light);
    font-size: 1rem;
}

.insight-body {
    padding: 20px;
}

.insight-body p {
    font-size: 0.85rem;
    color: var(--text-muted);
    line-height: 1.6;
    margin-bottom: 12px;
}

.insight-body p strong {
    color: var(--primary);
}

.insight-stats {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-item {
    text-align: center;
}

.stat-val {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
}

.stat-lbl {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.stat-arrow {
    font-size: 1.5rem;
    color: #4caf50;
}

/* ===== CONSTRAINT VALIDATION (Scene 9) ===== */

.validation-architecture {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
}

.val-stage {
    background: rgba(255, 255, 255, 0.02);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
}

.val-stage .stage-label {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 15px;
    text-align: center;
}

.model-updates, .validity-scores {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.update-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 15px;
    background: rgba(33, 150, 243, 0.1);
    border: 1px solid rgba(33, 150, 243, 0.3);
    border-radius: 12px;
    min-width: 80px;
}

.fac-icon {
    font-size: 1.5rem;
}

.update-symbol {
    font-family: 'Consolas', monospace;
    font-size: 0.9rem;
    color: #2196f3;
}

/* Validation Flow Arrow */
.val-flow-arrow {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 0;
}

.flow-svg {
    width: 100px;
    height: 40px;
}

.flow-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 5px;
}

/* Validation Core */
.validation-core {
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), transparent);
    border: 2px solid rgba(156, 39, 176, 0.3);
}

.val-step {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
}

.val-step:last-child {
    margin-bottom: 0;
}

.step-badge {
    display: inline-block;
    background: var(--purple);
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-bottom: 10px;
}

.step-title {
    font-weight: 600;
    color: var(--light);
    font-size: 0.95rem;
    margin-bottom: 12px;
}

.step-detail {
    padding-left: 10px;
}

/* Prediction Generation */
.prediction-gen {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    margin-bottom: 10px;
}

.pred-input, .pred-output {
    font-family: 'Consolas', monospace;
    font-size: 0.9rem;
    color: #64b5f6;
    padding: 10px 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
}

.pred-arrow {
    font-size: 1.5rem;
    color: var(--purple);
}

.step-note {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-align: center;
}

/* Constraint Checks */
.constraint-checks {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

.check-item {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.check-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
}

.check-icon {
    font-size: 1rem;
}

.check-type {
    font-weight: 600;
    color: var(--light);
    font-size: 0.8rem;
}

.check-formula {
    margin-bottom: 8px;
}

.check-formula code {
    font-family: 'Consolas', monospace;
    font-size: 0.7rem;
    color: #81c784;
}

.check-visual {
    font-size: 0.7rem;
    color: var(--text-muted);
}

.cv-label {
    color: var(--text-muted);
}

.cv-example {
    color: #4caf50;
    font-family: monospace;
}

/* Score Computation */
.score-computation {
    display: flex;
    gap: 30px;
    align-items: flex-start;
}

.score-formula-box {
    flex: 1;
    text-align: center;
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
}

.formula-main {
    font-size: 1.5rem;
    color: var(--light);
    margin-bottom: 10px;
}

.frac {
    display: inline-flex;
    flex-direction: column;
    vertical-align: middle;
    text-align: center;
    margin: 0 5px;
}

.frac .num {
    border-bottom: 2px solid var(--light);
    padding-bottom: 3px;
}

.frac .den {
    padding-top: 3px;
}

.formula-range {
    font-size: 0.85rem;
    color: #4caf50;
}

.score-explanation {
    flex: 1;
}

.exp-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 8px 0;
}

.exp-icon {
    font-size: 1rem;
}

.exp-text {
    font-size: 0.85rem;
    color: var(--text-muted);
}

/* Validity Scores Output */
.score-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 12px 15px;
    border-radius: 10px;
    min-width: 100px;
}

.score-box.high-score {
    background: rgba(76, 175, 80, 0.15);
    border: 1px solid rgba(76, 175, 80, 0.4);
}

.score-box.medium-score {
    background: rgba(255, 193, 7, 0.15);
    border: 1px solid rgba(255, 193, 7, 0.4);
}

.score-box.low-score {
    background: rgba(244, 67, 54, 0.15);
    border: 1px solid rgba(244, 67, 54, 0.4);
}

.fac-label {
    font-size: 0.7rem;
    color: var(--text-muted);
}

.score-val {
    font-family: 'Consolas', monospace;
    font-size: 0.9rem;
    font-weight: 600;
}

.high-score .score-val { color: #4caf50; }
.medium-score .score-val { color: #ffc107; }
.low-score .score-val { color: #f44336; }

.score-bar {
    width: 80px;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
}

.bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 1s ease;
}

.high-score .bar-fill { background: #4caf50; }
.medium-score .bar-fill { background: #ffc107; }
.low-score .bar-fill { background: #f44336; }

/* No Categorization Box */
.no-categorization-box {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.nc-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(255, 193, 7, 0.15);
    border-bottom: 2px solid #ffc107;
}

.nc-icon {
    font-size: 1.3rem;
}

.nc-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.nc-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    padding: 20px;
}

.nc-problem, .nc-solution {
    padding: 15px;
    border-radius: 12px;
}

.nc-problem {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.nc-solution {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.problem-title, .solution-title {
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 12px;
}

.problem-title { color: #f44336; }
.solution-title { color: #4caf50; }

.problem-list, .solution-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.problem-list li, .solution-list li {
    padding: 6px 0;
    font-size: 0.8rem;
    color: var(--text-muted);
    padding-left: 15px;
    position: relative;
}

.problem-list li::before {
    content: '✗';
    position: absolute;
    left: 0;
    color: #f44336;
}

.solution-list li::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: #4caf50;
}

/* Weight Formula Section */
.weight-formula-section {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), transparent);
    border: 2px solid rgba(76, 175, 80, 0.3);
    border-radius: 15px;
    padding: 20px;
}

.formula-header {
    text-align: center;
    margin-bottom: 20px;
}

.formula-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.formula-display {
    text-align: center;
    margin-bottom: 20px;
}

.main-formula {
    font-size: 2rem;
    color: var(--light);
    margin-bottom: 15px;
}

.formula-legend {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
}

.legend-item {
    font-size: 0.8rem;
    color: var(--text-muted);
}

.formula-insight {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
}

.formula-insight .insight-icon {
    font-size: 1.2rem;
}

.formula-insight .insight-text {
    font-size: 0.85rem;
    color: var(--text-muted);
    line-height: 1.5;
}

/* ===== CONVERGENCE IMPACT (Scene 10) ===== */

.convergence-analysis {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 20px;
    margin-bottom: 20px;
}

.convergence-theory, .convergence-visual {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
}

.theory-header, .visual-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.theory-icon, .visual-icon {
    font-size: 1.3rem;
}

.theory-title, .visual-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.theory-content {
    padding: 20px;
}

/* Theorem Box */
.theorem-box {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 152, 0, 0.3);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
}

.theorem-label {
    font-size: 0.8rem;
    font-weight: 700;
    color: #ff9800;
    margin-bottom: 10px;
}

.theorem-statement {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 12px;
}

.theorem-formula {
    font-size: 1.1rem;
    color: var(--light);
    text-align: center;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    margin-bottom: 12px;
    overflow-x: auto;
}

.highlight-term {
    color: #4caf50;
    font-weight: 700;
}

.theorem-terms {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
}

.term-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.75rem;
}

.term-symbol {
    font-family: 'Consolas', monospace;
    color: #ff9800;
    font-weight: 600;
}

.term-def {
    color: var(--text-muted);
}

/* Insight Callout */
.insight-callout {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 15px;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 10px;
    border-left: 4px solid #4caf50;
}

.callout-icon {
    font-size: 1.3rem;
}

.callout-content {
    font-size: 0.85rem;
    color: var(--light);
    line-height: 1.5;
}

/* Convergence Chart */
.convergence-chart {
    padding: 20px;
    display: grid;
    grid-template-columns: 50px 1fr;
    grid-template-rows: 1fr 50px;
    gap: 10px;
}

.chart-yaxis {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.chart-yaxis .axis-label {
    writing-mode: vertical-rl;
    transform: rotate(180deg);
    font-size: 0.75rem;
    color: var(--text-muted);
}

.chart-yaxis .axis-ticks {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
    font-size: 0.65rem;
    color: var(--text-muted);
}

.chart-area {
    position: relative;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    height: 200px;
}

.chart-grid {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 10px 0;
}

.grid-line {
    border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
}

.convergence-line {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.line-path {
    stroke-dasharray: 500;
    stroke-dashoffset: 500;
    animation: drawLine 2s ease forwards;
}

@keyframes drawLine {
    to { stroke-dashoffset: 0; }
}

.fedavg-path { animation-delay: 0.5s; }
.scfa-path { animation-delay: 1s; }

.convergence-marker {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.marker-line {
    width: 2px;
    height: 20px;
    background: var(--light);
}

.marker-label {
    font-size: 0.7rem;
    color: var(--light);
    background: rgba(0, 0, 0, 0.7);
    padding: 3px 8px;
    border-radius: 4px;
    white-space: nowrap;
}

.chart-xaxis {
    grid-column: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.chart-xaxis .axis-ticks {
    display: flex;
    justify-content: space-between;
    width: 100%;
    font-size: 0.65rem;
    color: var(--text-muted);
}

.chart-xaxis .axis-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 5px;
}

/* Chart Legend */
.chart-legend {
    display: flex;
    justify-content: center;
    gap: 30px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.legend-line {
    width: 30px;
    height: 3px;
    border-radius: 2px;
}

.legend-line.fedavg { background: #f44336; }
.legend-line.scfa { background: #4caf50; }

.legend-text {
    font-size: 0.8rem;
    color: var(--text-muted);
}

.improvement {
    color: #4caf50;
    font-weight: 600;
}

/* Mechanism Explanation */
.mechanism-explanation {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.mech-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.mech-icon {
    font-size: 1.3rem;
}

.mech-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.mechanism-flow {
    display: flex;
    align-items: stretch;
    padding: 20px;
    gap: 15px;
}

.mech-step {
    flex: 1;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.mech-step-num {
    width: 30px;
    height: 30px;
    background: var(--purple);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin-bottom: 12px;
}

.mech-step-title {
    font-weight: 600;
    color: var(--light);
    font-size: 0.9rem;
    margin-bottom: 12px;
}

.mech-step-visual {
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 12px;
}

.mech-step-text {
    font-size: 0.8rem;
    color: var(--text-muted);
    text-align: center;
}

.mech-arrow {
    display: flex;
    align-items: center;
    font-size: 1.5rem;
    color: var(--purple);
}

/* Space Diagram */
.space-diagram {
    width: 100%;
}

.full-space {
    width: 100%;
    height: 80px;
    background: rgba(244, 67, 54, 0.15);
    border: 2px solid rgba(244, 67, 54, 0.4);
    border-radius: 10px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.full-space .space-label {
    position: absolute;
    top: 5px;
    left: 10px;
    font-size: 0.65rem;
    color: #f44336;
}

.constrained-space {
    width: 40%;
    height: 50px;
    background: rgba(76, 175, 80, 0.3);
    border: 2px solid #4caf50;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.constrained-space .space-label {
    font-size: 0.6rem;
    color: #4caf50;
    text-align: center;
}

/* Variance Comparison */
.variance-comparison {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
}

.var-item {
    padding: 10px;
    border-radius: 8px;
    text-align: center;
}

.var-item.high-var {
    background: rgba(244, 67, 54, 0.15);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.var-item.low-var {
    background: rgba(76, 175, 80, 0.15);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.var-arrows {
    font-size: 1rem;
    margin-bottom: 5px;
}

.var-arrows.scattered span {
    display: inline-block;
    margin: 0 3px;
    color: #f44336;
}

.var-arrows.aligned span {
    display: inline-block;
    margin: 0 1px;
    color: #4caf50;
}

.var-label {
    font-size: 0.7rem;
    color: var(--text-muted);
}

/* Convergence Metric */
.convergence-comparison {
    text-align: center;
}

.conv-metric {
    background: rgba(76, 175, 80, 0.2);
    border: 2px solid #4caf50;
    border-radius: 12px;
    padding: 15px;
}

.metric-val {
    display: block;
    font-size: 2rem;
    font-weight: 700;
    color: #4caf50;
}

.metric-label {
    font-size: 0.75rem;
    color: var(--text-muted);
}

/* Empirical Validation */
.empirical-validation {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.emp-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.emp-icon {
    font-size: 1.3rem;
}

.emp-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.emp-content {
    padding: 20px;
}

.emp-table {
    width: 100%;
}

.table-header {
    display: grid;
    grid-template-columns: 1.5fr 1fr 1fr 1fr;
    gap: 15px;
    padding: 12px 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px 8px 0 0;
}

.th {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
}

.table-row {
    display: grid;
    grid-template-columns: 1.5fr 1fr 1fr 1fr;
    gap: 15px;
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.table-row.baseline {
    background: rgba(255, 255, 255, 0.02);
}

.table-row.highlight-row {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
    border-radius: 0 0 8px 8px;
}

.td {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.td.method {
    font-weight: 600;
    color: var(--light);
}

.td.highlight-val {
    color: #4caf50;
    font-weight: 600;
}

.td.improvement {
    color: #4caf50;
}

.td.improvement.best {
    font-weight: 700;
}

.td.baseline-ref {
    color: var(--text-muted);
}

.emp-footnote {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    margin-top: 15px;
}

.footnote-icon {
    font-size: 1rem;
}

.footnote-text {
    font-size: 0.75rem;
    color: var(--text-muted);
    line-height: 1.5;
}

/* Threshold Callout */
.threshold-callout {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
}

.callout-warning {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    background: rgba(255, 152, 0, 0.15);
    border-bottom: 2px solid #ff9800;
}

.warning-icon {
    font-size: 1.3rem;
}

.warning-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.threshold-callout .callout-content {
    padding: 20px;
}

.threshold-visual {
    margin-bottom: 20px;
}

.threshold-bar {
    display: flex;
    align-items: stretch;
    height: 60px;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}

.bar-segment {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 10px 15px;
}

.bar-segment.good {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.1));
    border: 2px solid #4caf50;
    border-radius: 10px 0 0 10px;
}

.bar-segment.bad {
    background: linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(244, 67, 54, 0.05));
    border: 2px solid rgba(244, 67, 54, 0.3);
    border-radius: 0 10px 10px 0;
    border-left: none;
}

.seg-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--light);
}

.seg-effect {
    font-size: 0.7rem;
    color: var(--text-muted);
}

.threshold-marker {
    position: absolute;
    left: 18%;
    top: -10px;
    bottom: -10px;
    width: 4px;
    background: #ff9800;
    display: flex;
    align-items: center;
    justify-content: center;
}

.marker-val {
    position: absolute;
    top: -25px;
    background: #ff9800;
    color: white;
    padding: 3px 10px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    white-space: nowrap;
}

.threshold-explanation {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.threshold-explanation p {
    font-size: 0.85rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin: 0;
}

.threshold-explanation p strong {
    color: var(--light);
}

.threshold-validation {
    padding: 10px 15px;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 8px;
    border-left: 3px solid #4caf50;
}

/* Fly-in animations for items */
.fly-in-item {
    opacity: 0;
    transform: translateY(20px);
    animation: flyInItem 0.5s ease forwards;
}

@keyframes flyInItem {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive for ICML sections */
@media (max-width: 1200px) {
    .ontology-sources {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .extraction-process {
        grid-template-columns: 1fr;
    }
    
    .convergence-analysis {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .ontology-sources {
        grid-template-columns: 1fr;
    }
    
    .constraint-derivation {
        grid-template-columns: 1fr;
    }
    
    .constraint-checks {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .nc-content {
        grid-template-columns: 1fr;
    }
    
    .mechanism-flow {
        flex-direction: column;
    }
    
    .mech-arrow {
        transform: rotate(90deg);
        justify-content: center;
    }
    
    .score-computation {
        flex-direction: column;
    }
}

/* ============================================
   ANIMATED SEMANTIC & CONSTRAINT EXAMPLES
   ============================================ */

/* Container Layout */
.scfa-explained-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.scfa-section {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    border-bottom: 2px solid;
}

.section-header.semantic-bg {
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.3), rgba(156, 39, 176, 0.1));
    border-color: #9c27b0;
}

.section-header.constrained-bg {
    background: linear-gradient(135deg, rgba(255, 152, 0, 0.3), rgba(255, 152, 0, 0.1));
    border-color: #ff9800;
}

.section-icon {
    font-size: 1.5rem;
}

.section-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--light);
}

.section-intro {
    padding: 12px 20px;
    background: rgba(0, 0, 0, 0.2);
}

.section-intro p {
    margin: 0;
    font-size: 0.9rem;
    color: var(--light);
}

/* Example Carousel */
.animated-examples {
    padding: 15px;
}

.example-carousel {
    position: relative;
    min-height: 280px;
}

.flyio-example {
    display: none;
    animation: fadeInExample 0.5s ease;
}

.flyio-example.active {
    display: block;
}

@keyframes fadeInExample {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.example-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.ex-num {
    background: var(--purple);
    color: white;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 700;
}

.semantic-section .ex-num {
    background: #9c27b0;
}

.constrained-section .ex-num {
    background: #ff9800;
}

.ex-title {
    font-weight: 600;
    color: var(--light);
    font-size: 0.95rem;
}

.example-animation {
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    margin-bottom: 12px;
}

.example-insight {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 10px 12px;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 8px;
    border-left: 3px solid #4caf50;
}

.insight-icon {
    font-size: 1rem;
    flex-shrink: 0;
}

.example-insight span:last-child {
    font-size: 0.8rem;
    color: var(--light);
    line-height: 1.4;
}

/* Carousel Controls */
.carousel-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-top: 15px;
}

.carousel-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--light);
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.carousel-btn:hover {
    background: var(--purple);
    border-color: var(--purple);
}

.carousel-dots {
    display: flex;
    gap: 8px;
}

.carousel-dots .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    cursor: pointer;
    transition: all 0.3s ease;
}

.carousel-dots .dot.active {
    background: var(--purple);
    transform: scale(1.2);
}

.constrained-section .carousel-dots .dot.active {
    background: #ff9800;
}

/* Fly Animation Keyframes */
@keyframes flyInLeft {
    from { opacity: 0; transform: translateX(-50px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes flyInRight {
    from { opacity: 0; transform: translateX(50px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes flyInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes flyInDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}

.fly-left { animation: flyInLeft 0.6s ease forwards; opacity: 0; }
.fly-right { animation: flyInRight 0.6s ease forwards; opacity: 0; }
.fly-up { animation: flyInUp 0.6s ease forwards; opacity: 0; }
.fly-down { animation: flyInDown 0.6s ease forwards; opacity: 0; }

.flyio-example.active .fly-left,
.flyio-example.active .fly-right,
.flyio-example.active .fly-up,
.flyio-example.active .fly-down {
    animation-play-state: running;
}

/* Animation delays */
[data-delay="0"] { animation-delay: 0s; }
[data-delay="200"] { animation-delay: 0.2s; }
[data-delay="300"] { animation-delay: 0.3s; }
[data-delay="400"] { animation-delay: 0.4s; }
[data-delay="500"] { animation-delay: 0.5s; }
[data-delay="600"] { animation-delay: 0.6s; }
[data-delay="800"] { animation-delay: 0.8s; }
[data-delay="900"] { animation-delay: 0.9s; }

/* ===== SEMANTIC EXAMPLE STYLES ===== */

/* Language Analogy */
.lang-demo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-bottom: 15px;
}

.lang-item {
    text-align: center;
    padding: 15px 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
}

.lang-flag {
    font-size: 2rem;
    margin-bottom: 8px;
}

.lang-word {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--light);
}

.lang-equals {
    font-size: 1.5rem;
    color: #4caf50;
    font-weight: 700;
}

.lang-meaning {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    padding: 12px 20px;
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05));
    border-radius: 10px;
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.meaning-icon {
    font-size: 2rem;
}

.meaning-text {
    font-size: 0.85rem;
    color: var(--light);
}

/* Feature Encoding */
.encoding-demo {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

.encoding-factory {
    flex: 1;
    min-width: 140px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.factory-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--light);
    margin-bottom: 10px;
    text-align: center;
}

.feature-vector {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.vec-item {
    font-size: 0.75rem;
    padding: 6px 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
    color: var(--text-muted);
    font-family: monospace;
}

.vec-item.active {
    background: rgba(156, 39, 176, 0.3);
    color: #9c27b0;
    font-weight: 600;
    border: 1px solid rgba(156, 39, 176, 0.5);
}

.encoding-problem {
    text-align: center;
}

.problem-badge {
    display: inline-block;
    padding: 8px 16px;
    background: rgba(244, 67, 54, 0.2);
    border: 1px solid rgba(244, 67, 54, 0.4);
    border-radius: 20px;
    color: #f44336;
    font-size: 0.8rem;
    font-weight: 500;
}

/* Real World Meaning */
.realworld-demo {
    text-align: center;
}

.rw-scenario {
    margin-bottom: 15px;
}

.rw-value {
    font-size: 1.2rem;
    color: var(--light);
}

.highlight-val {
    color: #ff9800;
    font-weight: 700;
    font-size: 1.4rem;
}

.rw-interpretations {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.rw-interp {
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    flex: 1;
    min-width: 120px;
}

.interp-factory {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.interp-meaning {
    font-size: 0.9rem;
    color: var(--light);
    line-height: 1.3;
}

.rw-vs {
    font-weight: 700;
    color: var(--text-muted);
    font-size: 0.9rem;
}

/* ===== CONSTRAINT EXAMPLE STYLES ===== */

/* Temporal Constraint */
.temporal-demo {
    text-align: center;
}

.temporal-rule, .capacity-rule, .conservation-rule {
    margin-bottom: 15px;
}

.temporal-rule code, .capacity-rule code, .conservation-rule code {
    display: inline-block;
    padding: 8px 16px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 8px;
    font-family: 'Consolas', monospace;
    font-size: 0.9rem;
    color: #ff9800;
}

.temporal-visual {
    margin-bottom: 12px;
}

.tool-stages {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    flex-wrap: wrap;
}

.tool-stage {
    text-align: center;
    padding: 10px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    min-width: 70px;
}

.tool-icon {
    font-size: 1.5rem;
    margin-bottom: 5px;
}

.tool-state {
    font-size: 0.7rem;
    margin-bottom: 8px;
}

.tool-state.new { color: #4caf50; }
.tool-state.used { color: #ff9800; }
.tool-state.worn { color: #f44336; }

.wear-bar {
    width: 60px;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    margin: 0 auto;
}

.wear-fill {
    height: 100%;
    background: linear-gradient(90deg, #4caf50, #ff9800, #f44336);
    border-radius: 4px;
    transition: width 0.5s ease;
}

.stage-arrow {
    font-size: 1.2rem;
    color: var(--text-muted);
}

.constraint-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: rgba(76, 175, 80, 0.15);
    border: 1px solid rgba(76, 175, 80, 0.3);
    border-radius: 10px;
    font-size: 0.8rem;
    color: var(--light);
}

.badge-icon {
    color: #4caf50;
    font-size: 1rem;
}

/* Causal Constraint */
.causal-demo {
    text-align: center;
}

.causal-chain {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

.causal-node {
    text-align: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    min-width: 80px;
}

.node-icon {
    font-size: 1.8rem;
    margin-bottom: 8px;
}

.node-label {
    font-size: 0.7rem;
    color: var(--light);
    line-height: 1.3;
}

.causal-arrow {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #ff9800;
}

.causal-arrow span {
    font-size: 0.65rem;
    color: var(--text-muted);
}

.arrow-line {
    font-size: 1.2rem;
    font-weight: 700;
}

/* Capacity Constraint */
.capacity-demo {
    text-align: center;
}

.thermometer-visual {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 15px;
}

.thermo-scale {
    width: 120px;
    border-radius: 10px;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.thermo-zone {
    padding: 10px 8px;
    text-align: center;
    font-size: 0.7rem;
}

.thermo-zone.danger-high {
    background: rgba(244, 67, 54, 0.3);
    color: #f44336;
}

.thermo-zone.safe {
    background: rgba(76, 175, 80, 0.3);
    padding: 15px 8px;
}

.safe-label {
    display: block;
    color: #4caf50;
    font-weight: 600;
    margin-bottom: 4px;
}

.safe-range {
    display: block;
    color: var(--light);
    font-size: 0.75rem;
}

.thermo-zone.danger-low {
    background: rgba(33, 150, 243, 0.3);
    color: #2196f3;
}

.thermo-pointer {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: rgba(76, 175, 80, 0.2);
    border-radius: 8px;
    border: 1px solid #4caf50;
}

.pointer-val {
    font-size: 1.1rem;
    font-weight: 700;
    color: #4caf50;
}

.pointer-arrow {
    color: #4caf50;
}

/* Physical Constraint */
.physical-demo {
    text-align: center;
}

.energy-visual {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

.energy-in, .energy-out {
    padding: 10px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    min-width: 100px;
}

.energy-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.energy-items {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.e-item {
    font-size: 0.75rem;
    color: var(--light);
    padding: 4px 8px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.energy-machine {
    padding: 15px;
}

.machine-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    background: rgba(255, 152, 0, 0.15);
    border: 2px solid #ff9800;
    border-radius: 10px;
}

.machine-box span {
    font-size: 2rem;
}

.machine-box small {
    font-size: 0.7rem;
    color: var(--text-muted);
}

/* Why Needed Bar */
.why-needed-bar {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
    border-radius: 12px;
    padding: 15px 20px;
}

.why-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}

.why-icon {
    font-size: 1.3rem;
}

.why-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.why-problems {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.problem-item {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    min-width: 200px;
}

.prob-icon {
    color: #f44336;
}

.prob-text {
    font-size: 0.8rem;
    color: var(--text-muted);
}

.prob-text strong {
    color: var(--light);
}

/* Responsive */
@media (max-width: 1024px) {
    .scfa-explained-container {
        grid-template-columns: 1fr;
    }
    
    .why-problems {
        flex-direction: column;
        gap: 10px;
    }
}

@media (max-width: 600px) {
    .lang-demo {
        flex-direction: column;
        gap: 10px;
    }
    
    .encoding-demo {
        flex-direction: column;
    }
    
    .tool-stages {
        flex-direction: column;
    }
    
    .stage-arrow {
        transform: rotate(90deg);
    }
    
    .causal-chain {
        flex-direction: column;
    }
    
    .causal-arrow {
        transform: rotate(90deg);
    }
}

/* ============================================
   FAQ SECTION FOR REVIEWERS
   ============================================ */
.chapter-badge.faq {
    background: linear-gradient(135deg, rgba(255, 152, 0, 0.2), rgba(244, 67, 54, 0.2));
    border-color: #ff9800;
}

.faq-container {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 20px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.faq-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.faq-tab {
    padding: 10px 18px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.3s ease;
}

.faq-tab:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--light);
}

.faq-tab.active {
    background: var(--purple);
    border-color: var(--purple);
    color: white;
}

.faq-content {
    padding: 20px;
    max-height: 500px;
    overflow-y: auto;
}

.faq-category {
    display: none;
}

.faq-category.active {
    display: block;
    animation: faqFadeIn 0.3s ease;
}

@keyframes faqFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.faq-item {
    background: rgba(255, 255, 255, 0.02);
    border-radius: 12px;
    margin-bottom: 15px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    overflow: hidden;
}

.faq-item:last-child {
    margin-bottom: 0;
}

.faq-question {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
    cursor: pointer;
}

.q-icon {
    background: var(--purple);
    color: white;
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 700;
    flex-shrink: 0;
}

.q-text {
    font-size: 0.9rem;
    color: var(--light);
    font-weight: 500;
    line-height: 1.4;
}

.faq-answer {
    padding: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.faq-answer p {
    font-size: 0.85rem;
    color: var(--text-muted);
    line-height: 1.6;
    margin-bottom: 12px;
}

.faq-answer p:last-child {
    margin-bottom: 0;
}

.faq-answer p strong {
    color: var(--light);
}

.answer-list {
    list-style: none;
    padding: 0;
    margin: 12px 0;
}

.answer-list li {
    padding: 6px 0;
    padding-left: 20px;
    position: relative;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.answer-list li::before {
    content: '•';
    position: absolute;
    left: 0;
    color: var(--purple);
}

.answer-list li strong {
    color: var(--light);
}

.answer-evidence {
    background: rgba(76, 175, 80, 0.1);
    border-left: 3px solid #4caf50;
    padding: 10px 15px;
    border-radius: 0 8px 8px 0;
    font-size: 0.8rem !important;
    color: #4caf50 !important;
}

.answer-comparison {
    display: flex;
    align-items: center;
    gap: 15px;
    margin: 15px 0;
    flex-wrap: wrap;
}

.comp-item {
    flex: 1;
    min-width: 150px;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
}

.comp-item.existing {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.comp-item.ours {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.comp-label {
    display: block;
    font-weight: 600;
    font-size: 0.85rem;
    color: var(--light);
    margin-bottom: 5px;
}

.comp-desc {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.comp-vs {
    font-weight: 700;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.ontology-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 10px 0;
}

.onto-badge {
    background: rgba(156, 39, 176, 0.2);
    color: #9c27b0;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 500;
}

.code-snippet {
    background: rgba(0, 0, 0, 0.4);
    padding: 10px 15px;
    border-radius: 8px;
    margin: 10px 0;
}

.code-snippet code {
    font-family: 'Consolas', monospace;
    font-size: 0.8rem;
    color: var(--rq2);
}

.overhead-stats {
    display: flex;
    gap: 15px;
    margin: 15px 0;
    flex-wrap: wrap;
}

.overhead-item {
    flex: 1;
    min-width: 120px;
    background: rgba(255, 255, 255, 0.03);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
}

.overhead-value {
    display: block;
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--rq2);
    margin-bottom: 5px;
}

.overhead-label {
    font-size: 0.7rem;
    color: var(--text-muted);
}

.privacy-comparison {
    margin: 15px 0;
}

.priv-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    margin-bottom: 8px;
    font-size: 0.85rem;
}

.priv-item.highlight {
    background: rgba(76, 175, 80, 0.15);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.priv-method {
    color: var(--light);
    font-weight: 500;
}

.priv-loss {
    color: var(--text-muted);
}

.priv-item.highlight .priv-loss {
    color: #4caf50;
    font-weight: 600;
}

.limitation-list li {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding-left: 0 !important;
}

.limitation-list li::before {
    display: none;
}

.lim-icon {
    flex-shrink: 0;
}

/* FAQ Quick Reference */
.faq-quick-ref {
    background: linear-gradient(135deg, rgba(41, 98, 255, 0.1), rgba(156, 39, 176, 0.1));
    border: 1px solid rgba(41, 98, 255, 0.3);
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
}

.qr-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.qr-icon {
    font-size: 1.3rem;
}

.qr-title {
    font-weight: 600;
    color: var(--light);
    font-size: 1rem;
}

.qr-stats {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 15px;
}

.qr-stat {
    text-align: center;
    padding: 10px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
}

.qr-value {
    display: block;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 5px;
}

.qr-label {
    font-size: 0.7rem;
    color: var(--text-muted);
}

/* Responsive FAQ */
@media (max-width: 1024px) {
    .qr-stats {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    .faq-tabs {
        justify-content: center;
    }
    
    .faq-tab {
        padding: 8px 12px;
        font-size: 0.8rem;
    }
    
    .qr-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .answer-comparison {
        flex-direction: column;
    }
    
    .comp-vs {
        transform: rotate(90deg);
    }
}

/* ============================================
   SEMANTIC-CONSTRAINED EXPLANATION SCENE
   ============================================ */
.highlight-semantic {
    color: #9c27b0;
    text-shadow: 0 0 20px rgba(156, 39, 176, 0.5);
}

.highlight-constrained {
    color: #ff9800;
    text-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
}

.chapter-badge.novelty {
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(255, 152, 0, 0.2));
    border-color: #9c27b0;
}

/* Definition Box */
.scfa-definition-box {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(255, 152, 0, 0.1));
    border: 1px solid rgba(156, 39, 176, 0.3);
    border-radius: 15px;
    padding: 20px 25px;
    margin-bottom: 25px;
}

.def-icon {
    font-size: 2rem;
    flex-shrink: 0;
}

.def-content {
    flex: 1;
}

.def-label {
    font-size: 0.8rem;
    color: var(--purple);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.def-text {
    font-size: 1.05rem;
    color: var(--light);
    line-height: 1.6;
}

.def-text strong {
    color: #9c27b0;
}

/* Three Pillars */
.scfa-pillars {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 25px;
}

.scfa-pillar {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.scfa-pillar:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.pillar-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 20px;
    border-bottom: 2px solid;
}

.pillar-header.semantic-header {
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), transparent);
    border-color: #9c27b0;
}

.pillar-header.constrained-header {
    background: linear-gradient(135deg, rgba(255, 152, 0, 0.2), transparent);
    border-color: #ff9800;
}

.pillar-header.why-header {
    background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), transparent);
    border-color: #f44336;
}

.pillar-icon {
    font-size: 1.5rem;
}

.pillar-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--light);
}

.pillar-question {
    padding: 12px 20px;
    font-size: 0.85rem;
    color: var(--text-muted);
    font-style: italic;
    background: rgba(0, 0, 0, 0.2);
}

.pillar-content {
    padding: 15px 20px;
}

.pillar-content p {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 12px;
}

.pillar-content p strong {
    color: var(--light);
}

.pillar-list {
    list-style: none;
    padding: 0;
    margin: 0 0 15px 0;
}

.pillar-list li {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 6px 0;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.pillar-list li em {
    color: var(--light);
    font-style: normal;
    font-weight: 500;
}

.list-icon {
    flex-shrink: 0;
    width: 20px;
    text-align: center;
}

.problem-list li .list-icon {
    color: #f44336;
}

.pillar-example {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    padding: 10px 12px;
    border-left: 3px solid var(--purple);
}

.example-label {
    font-size: 0.7rem;
    color: var(--purple);
    font-weight: 600;
    text-transform: uppercase;
    margin-bottom: 4px;
}

.example-text {
    font-size: 0.8rem;
    color: var(--light);
    font-style: italic;
}

.constraint-types {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.constraint-tag {
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.7rem;
    font-weight: 500;
}

.constraint-tag.geometric {
    background: rgba(33, 150, 243, 0.2);
    color: #2196f3;
}

.constraint-tag.statistical {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
}

.constraint-tag.knowledge {
    background: rgba(156, 39, 176, 0.2);
    color: #9c27b0;
}

/* Visual Comparison */
.scfa-comparison {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
}

.comparison-title {
    text-align: center;
    color: var(--light);
    font-size: 1rem;
    margin-bottom: 20px;
    font-weight: 600;
}

.comparison-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.comparison-side {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    overflow: hidden;
}

.side-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 15px;
    font-weight: 600;
    font-size: 0.9rem;
}

.side-header.problem-header {
    background: rgba(244, 67, 54, 0.2);
    color: #f44336;
}

.side-header.solution-header {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
}

.side-icon {
    font-size: 1.2rem;
}

.embedding-visual {
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.facility-embedding {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    padding: 10px 12px;
}

.emb-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 6px;
}

.emb-vector {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.dim {
    font-size: 0.7rem;
    padding: 4px 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    color: var(--text-muted);
    font-family: monospace;
}

.dim.dim-active {
    background: rgba(156, 39, 176, 0.2);
    color: #9c27b0;
    font-weight: 500;
}

.dim.dim-aligned {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
}

.avg-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px;
    font-size: 0.8rem;
    font-weight: 600;
}

.avg-arrow.problem-arrow {
    color: #f44336;
}

.arrow-icon {
    width: 20px;
    height: 20px;
    fill: currentColor;
}

.transform-step {
    padding: 10px;
    text-align: center;
}

.transform-label {
    font-size: 0.7rem;
    color: #4caf50;
    padding: 3px 0;
}

.result-box {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    margin: 10px;
    border-radius: 8px;
}

.result-box.problem-result {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.result-box.solution-result {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.result-icon {
    font-size: 1.5rem;
}

.result-text {
    display: flex;
    flex-direction: column;
}

.result-text strong {
    font-size: 0.85rem;
    color: var(--light);
}

.result-text span {
    font-size: 0.75rem;
    color: var(--text-muted);
}

/* Key Takeaway */
.scfa-takeaway {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    background: linear-gradient(135deg, rgba(41, 98, 255, 0.1), rgba(156, 39, 176, 0.1));
    border: 2px solid var(--primary);
    border-radius: 15px;
    padding: 20px 25px;
}

.takeaway-icon {
    font-size: 2rem;
    flex-shrink: 0;
}

.takeaway-content {
    flex: 1;
}

.takeaway-label {
    font-size: 0.8rem;
    color: var(--primary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.takeaway-text {
    font-size: 0.95rem;
    color: var(--light);
    line-height: 1.6;
}

.takeaway-text strong {
    color: var(--primary);
}

/* Responsive for Semantic Explanation */
@media (max-width: 1024px) {
    .scfa-pillars {
        grid-template-columns: 1fr;
    }
    
    .comparison-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 600px) {
    .scfa-definition-box,
    .scfa-takeaway {
        flex-direction: column;
        text-align: center;
    }
}

/* ============================================
   ARCHITECTURE VISUALIZATION SYSTEM
   ============================================ */
.arch-viz-container {
    background: linear-gradient(135deg, rgba(15, 15, 25, 0.95), rgba(20, 20, 35, 0.98));
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
    margin-bottom: 25px;
}

.arch-viz-container.fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 9999;
    border-radius: 0;
    margin: 0;
    overflow: auto;
}

.arch-viz-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    flex-wrap: wrap;
    gap: 10px;
}

.arch-viz-tabs {
    display: flex;
    gap: 8px;
}

.arch-viz-tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 18px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.arch-viz-tab:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--light);
}

.arch-viz-tab.active {
    background: var(--purple);
    border-color: var(--purple);
    color: white;
}

.tab-icon {
    font-size: 1.1rem;
}

.arch-viz-controls {
    display: flex;
    gap: 8px;
}

.arch-ctrl-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.3s ease;
}

.arch-ctrl-btn:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.arch-viz-content {
    padding: 25px;
    min-height: 500px;
}

.arch-view {
    display: none;
}

.arch-view.active {
    display: block;
    animation: viewFadeIn 0.5s ease;
}

@keyframes viewFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ============================================
   PIPELINE FLOW VIEW
   ============================================ */
.pipeline-main {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 20px 0;
    position: relative;
    overflow-x: auto;
}

.pipeline-flow-line {
    position: absolute;
    top: 55px;
    left: 60px;
    right: 160px;
    height: 4px;
    background: linear-gradient(90deg, 
        #2196f3 0%, 
        #9c27b0 20%, 
        #ff9800 40%, 
        #4caf50 60%, 
        #e91e63 80%, 
        var(--primary) 100%
    );
    border-radius: 2px;
    z-index: 0;
    animation: flowLineGrow 1.5s ease-out forwards;
    transform-origin: left;
}

@keyframes flowLineGrow {
    from { transform: scaleX(0); }
    to { transform: scaleX(1); }
}

.flow-particle {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    top: -3px;
    animation: particleTravel 4s linear infinite;
}

.flow-particle.p1 { background: #2196f3; box-shadow: 0 0 12px #2196f3; animation-delay: 0s; }
.flow-particle.p2 { background: #9c27b0; box-shadow: 0 0 12px #9c27b0; animation-delay: 0.8s; }
.flow-particle.p3 { background: #ff9800; box-shadow: 0 0 12px #ff9800; animation-delay: 1.6s; }
.flow-particle.p4 { background: #4caf50; box-shadow: 0 0 12px #4caf50; animation-delay: 2.4s; }
.flow-particle.p5 { background: #e91e63; box-shadow: 0 0 12px #e91e63; animation-delay: 3.2s; }

@keyframes particleTravel {
    0% { left: 0; opacity: 0; }
    5% { opacity: 1; }
    95% { opacity: 1; }
    100% { left: 100%; opacity: 0; }
}

/* Pipeline Stage */
.pipeline-stage {
    flex: 1;
    min-width: 180px;
    max-width: 220px;
    z-index: 1;
    opacity: 0;
    transform: translateY(20px);
    animation: stageAppear 0.6s ease-out forwards;
    animation-delay: var(--stage-delay);
}

@keyframes stageAppear {
    to { opacity: 1; transform: translateY(0); }
}

.stage-node {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-bottom: 15px;
}

.stage-icon-wrap {
    position: relative;
    width: 70px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(0,0,0,0.5), rgba(0,0,0,0.3));
    border: 3px solid var(--stage-color);
    border-radius: 50%;
    margin-bottom: 10px;
    transition: all 0.3s ease;
}

.stage-icon-wrap:hover {
    transform: scale(1.1);
    box-shadow: 0 0 25px var(--stage-color);
}

.stage-icon {
    font-size: 1.8rem;
}

.stage-pulse {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 2px solid var(--stage-color);
    border-radius: 50%;
    animation: stagePulse 2s ease-out infinite;
    opacity: 0;
}

@keyframes stagePulse {
    0% { transform: scale(1); opacity: 0.5; }
    100% { transform: scale(1.5); opacity: 0; }
}

.stage-label {
    font-weight: 600;
    color: var(--light);
    font-size: 0.9rem;
    text-align: center;
}

.stage-connector {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 25px;
    margin: -5px 0;
}

.stage-connector svg {
    width: 50px;
    height: 20px;
}

.connector-line {
    stroke: var(--stage-color);
    stroke-width: 2;
    stroke-dasharray: 50;
    stroke-dashoffset: 50;
    animation: connectorDraw 0.5s ease-out forwards;
    animation-delay: calc(var(--stage-delay) + 0.3s);
}

.connector-arrow {
    fill: var(--stage-color);
    opacity: 0;
    animation: arrowAppear 0.3s ease-out forwards;
    animation-delay: calc(var(--stage-delay) + 0.6s);
}

@keyframes connectorDraw {
    to { stroke-dashoffset: 0; }
}

@keyframes arrowAppear {
    to { opacity: 1; }
}

/* Stage Details */
.stage-details {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    padding: 12px;
    border-left: 3px solid var(--stage-color);
}

.detail-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    opacity: 0;
    transform: translateX(-10px);
    animation: detailSlideIn 0.4s ease-out forwards;
    animation-delay: calc(var(--stage-delay) + var(--item-delay) + 0.5s);
}

.detail-item:last-child {
    border-bottom: none;
}

@keyframes detailSlideIn {
    to { opacity: 1; transform: translateX(0); }
}

.detail-icon {
    font-size: 1rem;
    flex-shrink: 0;
}

.detail-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.detail-text strong {
    color: var(--light);
    font-size: 0.8rem;
    font-weight: 600;
}

.detail-text span {
    color: var(--text-muted);
    font-size: 0.7rem;
}

/* Pipeline Output */
.pipeline-output {
    flex-shrink: 0;
    min-width: 160px;
    z-index: 1;
    opacity: 0;
    animation: outputAppear 0.8s ease-out forwards;
    animation-delay: var(--stage-delay);
}

@keyframes outputAppear {
    to { opacity: 1; }
}

.output-node {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.output-icon-wrap {
    position: relative;
    width: 90px;
    height: 90px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--primary), var(--purple));
    border-radius: 50%;
    margin-bottom: 12px;
    box-shadow: 0 5px 30px rgba(41, 98, 255, 0.4);
}

.output-icon {
    font-size: 2.2rem;
}

.output-ring {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 2px solid var(--primary);
    border-radius: 50%;
    animation: ringPulse 2s ease-out infinite;
}

.output-ring.r2 {
    animation-delay: 1s;
}

@keyframes ringPulse {
    0% { transform: scale(1); opacity: 0.6; }
    100% { transform: scale(1.6); opacity: 0; }
}

.output-label {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--light);
    margin-bottom: 5px;
}

.output-subtitle {
    font-size: 0.75rem;
    color: var(--text-muted);
    line-height: 1.3;
    margin-bottom: 15px;
}

.output-metrics {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.metric-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.05);
    padding: 6px 12px;
    border-radius: 8px;
}

.metric-value {
    font-weight: 700;
    color: var(--rq2);
    font-size: 0.9rem;
}

.metric-label {
    color: var(--text-muted);
    font-size: 0.75rem;
}

/* Evaluation Bar */
.pipeline-eval-bar {
    margin-top: 25px;
    background: rgba(0, 150, 136, 0.1);
    border: 1px solid rgba(0, 150, 136, 0.3);
    border-radius: 12px;
    padding: 15px 20px;
    opacity: 0;
    animation: evalBarAppear 0.6s ease-out 2s forwards;
}

@keyframes evalBarAppear {
    to { opacity: 1; }
}

.eval-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}

.eval-icon {
    font-size: 1.2rem;
}

.eval-title {
    font-weight: 600;
    color: var(--light);
    font-size: 0.95rem;
}

.eval-items {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
}

.eval-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px 14px;
    border-radius: 8px;
    font-size: 0.8rem;
    color: var(--text-muted);
    opacity: 0;
    animation: evalItemAppear 0.4s ease-out forwards;
    animation-delay: calc(2s + var(--eval-delay));
}

@keyframes evalItemAppear {
    to { opacity: 1; }
}

.eval-item-icon {
    font-size: 1rem;
}

.eval-badge {
    background: rgba(0, 150, 136, 0.3);
    color: #009688;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
}

/* ============================================
   CARD GRID VIEW
   ============================================ */
.grid-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.grid-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
}

/* Grid Card */
.grid-card {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
    opacity: 0;
    transform: translateY(20px);
    animation: cardAppear 0.5s ease-out forwards;
    animation-delay: var(--card-delay);
    transition: all 0.3s ease;
}

@keyframes cardAppear {
    to { opacity: 1; transform: translateY(0); }
}

.grid-card:hover {
    border-color: var(--card-color);
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
}

.card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px;
    background: linear-gradient(135deg, rgba(0,0,0,0.4), transparent);
    border-bottom: 2px solid var(--card-color);
}

.card-icon {
    font-size: 1.3rem;
}

.card-title {
    flex: 1;
    font-weight: 600;
    color: var(--light);
    font-size: 0.95rem;
}

.card-expand-btn {
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 6px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.8rem;
}

.card-expand-btn:hover {
    background: var(--card-color);
    color: white;
}

.card-expand-btn.expanded {
    transform: rotate(180deg);
}

.card-preview {
    padding: 12px 15px;
    font-size: 0.85rem;
    color: var(--text-muted);
}

.preview-stat {
    font-weight: 700;
    color: var(--card-color);
    font-size: 1.1rem;
}

.card-details {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease, padding 0.3s ease;
    background: rgba(0, 0, 0, 0.2);
}

.grid-card.expanded .card-details {
    max-height: 500px;
    padding: 15px;
}

.card-detail-item {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.card-detail-item:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.cdi-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}

.cdi-icon {
    font-size: 1rem;
}

.cdi-title {
    font-weight: 600;
    color: var(--light);
    font-size: 0.85rem;
}

.cdi-content code {
    display: block;
    background: rgba(0, 0, 0, 0.4);
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.7rem;
    color: var(--rq2);
    margin-bottom: 8px;
    overflow-x: auto;
    white-space: nowrap;
}

.cdi-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.cdi-stats span {
    background: rgba(255, 255, 255, 0.05);
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    color: var(--text-muted);
}

/* Grid Output Row */
.grid-output-row {
    position: relative;
    margin-top: 10px;
}

.grid-flow-arrows {
    height: 40px;
    margin-bottom: 15px;
}

.grid-flow-arrows svg {
    width: 100%;
    height: 100%;
}

.flow-arrow {
    stroke-dasharray: 100;
    stroke-dashoffset: 100;
    animation: flowArrowDraw 1s ease-out forwards;
}

.flow-arrow.fa1 { animation-delay: 0.8s; }
.flow-arrow.fa2 { animation-delay: 1s; }
.flow-arrow.fa3 { animation-delay: 1.2s; }

@keyframes flowArrowDraw {
    to { stroke-dashoffset: 0; }
}

.grid-output-card {
    display: flex;
    align-items: center;
    gap: 25px;
    background: linear-gradient(135deg, var(--primary), var(--purple));
    border-radius: 15px;
    padding: 25px 30px;
    opacity: 0;
    animation: gridOutputAppear 0.6s ease-out 1.5s forwards;
}

@keyframes gridOutputAppear {
    to { opacity: 1; }
}

.goc-icon {
    font-size: 3rem;
}

.goc-content {
    flex: 1;
}

.goc-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: white;
    margin-bottom: 5px;
}

.goc-subtitle {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 15px;
}

.goc-metrics {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.goc-metric {
    display: flex;
    flex-direction: column;
    background: rgba(0, 0, 0, 0.2);
    padding: 10px 15px;
    border-radius: 10px;
}

.goc-metric-value {
    font-size: 1.3rem;
    font-weight: 700;
    color: white;
}

.goc-metric-label {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.7);
}

/* GitHub CTA in Arch Viz */
.arch-github-cta {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.github-icon-wrap {
    color: white;
}

.github-cta-text {
    flex: 1;
}

.github-cta-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 3px;
}

.github-cta-link {
    color: #58a6ff;
    font-size: 0.9rem;
    font-weight: 500;
    text-decoration: none;
}

.github-cta-link:hover {
    text-decoration: underline;
}

/* Fullscreen Exit Button */
.arch-fullscreen-exit {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10001;
    padding: 12px 20px;
    background: rgba(244, 67, 54, 0.9);
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.9rem;
    display: none;
}

.arch-viz-container.fullscreen .arch-fullscreen-exit {
    display: block;
}

/* Responsive Architecture */
@media (max-width: 1200px) {
    .pipeline-main {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .pipeline-flow-line {
        display: none;
    }
    
    .pipeline-stage {
        min-width: 200px;
    }
    
    .grid-row {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .arch-viz-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .arch-viz-tabs {
        justify-content: center;
    }
    
    .arch-viz-controls {
        justify-content: center;
    }
    
    .pipeline-stage {
        min-width: 100%;
        max-width: 100%;
    }
    
    .grid-row {
        grid-template-columns: 1fr;
    }
    
    .grid-output-card {
        flex-direction: column;
        text-align: center;
    }
    
    .goc-metrics {
        justify-content: center;
    }
}

/* ============================================
   TECHNICAL IMPLEMENTATION SCENE
   ============================================ */
.impl-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.impl-tab {
    padding: 10px 20px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.impl-tab:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--light);
}

.impl-tab.active {
    background: var(--purple);
    border-color: var(--purple);
    color: white;
}

.impl-content {
    display: none;
    animation: fadeIn 0.3s ease;
}

.impl-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.impl-content h3 {
    color: var(--light);
    margin-bottom: 10px;
    font-size: 1.2rem;
}

.impl-desc {
    color: var(--text-muted);
    margin-bottom: 20px;
    font-size: 0.95rem;
}

/* Code Architecture */
.code-architecture {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.code-block {
    background: #1e1e2e;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.code-header {
    display: flex;
    justify-content: space-between;
    padding: 10px 15px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.code-lang {
    color: var(--rq2);
    font-weight: 600;
    font-size: 0.8rem;
}

.code-file {
    color: var(--text-muted);
    font-size: 0.75rem;
    font-family: monospace;
}

.code-content {
    padding: 15px;
    margin: 0;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.75rem;
    line-height: 1.5;
    overflow-x: auto;
    color: #abb2bf;
}

.code-content .kw { color: #c678dd; }
.code-content .cls { color: #e5c07b; }
.code-content .fn { color: #61afef; }
.code-content .str { color: #98c379; }
.code-content .num { color: #d19a66; }
.code-content .cmt { color: #5c6370; font-style: italic; }

/* Simulation Diagram */
.simulation-diagram {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.sim-header {
    text-align: center;
    color: var(--light);
    font-weight: 600;
    margin-bottom: 15px;
}

.facility-bars {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.fac-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    height: 35px;
}

.fac-bar::after {
    content: '';
    flex: 0 0 var(--width);
    height: 25px;
    background: var(--color);
    border-radius: 5px;
    transition: all 0.5s ease;
}

.fac-label {
    width: 30px;
    font-weight: 600;
    color: var(--light);
}

.fac-size {
    width: 50px;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.sim-note {
    text-align: center;
    color: var(--text-muted);
    font-size: 0.8rem;
    margin-top: 15px;
    font-style: italic;
}

.impl-libs {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
}

.lib-tag img {
    height: 22px;
}

/* Data Pipeline */
.data-pipeline {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
    justify-content: center;
}

.pipeline-stage {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    min-width: 180px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stage-icon {
    font-size: 2rem;
    margin-bottom: 10px;
}

.stage-name {
    color: var(--light);
    font-weight: 600;
    margin-bottom: 10px;
}

.stage-detail code {
    display: block;
    background: rgba(0, 0, 0, 0.3);
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.75rem;
    color: var(--rq2);
    margin-bottom: 10px;
}

.stage-detail ul {
    list-style: none;
    padding: 0;
    text-align: left;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.stage-detail li {
    padding: 3px 0;
}

.stage-detail li::before {
    content: '•';
    color: var(--purple);
    margin-right: 8px;
}

.pipeline-arrow {
    color: var(--purple);
    font-size: 1.5rem;
    align-self: center;
    padding-top: 20px;
}

/* Data Sources Table */
.data-sources-table {
    overflow-x: auto;
}

.data-sources-table table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
}

.data-sources-table th,
.data-sources-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.data-sources-table th {
    background: rgba(156, 39, 176, 0.2);
    color: var(--light);
    font-weight: 600;
}

.data-sources-table td {
    color: var(--text-muted);
}

.data-sources-table tr:hover td {
    background: rgba(255, 255, 255, 0.03);
}

/* KG Construction Flow */
.kg-construction-flow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin: 20px 0;
    flex-wrap: wrap;
}

.kg-step {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    padding: 15px 20px;
    text-align: center;
    min-width: 120px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.kg-step-num {
    width: 30px;
    height: 30px;
    background: var(--purple);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 10px;
    font-weight: 700;
    color: white;
}

.kg-step-name {
    color: var(--light);
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.kg-step-lib {
    color: var(--text-muted);
    font-size: 0.75rem;
}

.kg-step-arrow {
    color: var(--purple);
    font-size: 1.3rem;
}

/* Constraint Implementation Cards */
.constraint-types-impl {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-top: 20px;
}

.constraint-impl-card {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.cic-header {
    font-size: 0.85rem;
    font-weight: 600;
    padding: 5px 10px;
    border-radius: 6px;
    margin-bottom: 10px;
    display: inline-block;
}

.cic-header.temporal { background: rgba(33, 150, 243, 0.2); color: #2196f3; }
.cic-header.causal { background: rgba(255, 152, 0, 0.2); color: #ff9800; }
.cic-header.capacity { background: rgba(0, 150, 136, 0.2); color: #009688; }
.cic-header.physical { background: rgba(156, 39, 176, 0.2); color: #9c27b0; }

.constraint-impl-card code {
    display: block;
    font-size: 0.7rem;
    color: var(--rq2);
    margin-bottom: 8px;
    word-break: break-all;
}

.constraint-impl-card p {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin: 0;
}

/* Tech Stack Grid */
.tech-stack-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.stack-category {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stack-category h4 {
    color: var(--light);
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.stack-items {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.stack-item {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 10px;
    align-items: center;
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
}

.stack-name {
    color: var(--light);
    font-weight: 500;
    font-size: 0.9rem;
}

.stack-version {
    color: var(--rq2);
    font-size: 0.75rem;
    font-family: monospace;
    background: rgba(76, 175, 80, 0.1);
    padding: 2px 8px;
    border-radius: 4px;
}

.stack-use {
    color: var(--text-muted);
    font-size: 0.8rem;
}

/* GitHub CTA */
.github-cta {
    display: flex;
    align-items: center;
    gap: 20px;
    background: linear-gradient(135deg, rgba(36, 41, 46, 0.8), rgba(22, 27, 34, 0.9));
    border-radius: 15px;
    padding: 25px 30px;
    margin-top: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.github-icon {
    color: white;
    flex-shrink: 0;
}

.github-text {
    flex: 1;
}

.github-label {
    color: var(--text-muted);
    font-size: 0.85rem;
    margin-bottom: 5px;
}

.github-link {
    color: #58a6ff;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    word-break: break-all;
}

.github-link:hover {
    text-decoration: underline;
}

.github-badges {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.github-badges img {
    height: 22px;
}

/* Responsive for Implementation */
@media (max-width: 1024px) {
    .code-architecture {
        grid-template-columns: 1fr;
    }
    
    .tech-stack-grid {
        grid-template-columns: 1fr;
    }
    
    .constraint-types-impl {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .github-cta {
        flex-direction: column;
        text-align: center;
    }
}

@media (max-width: 600px) {
    .impl-tabs {
        flex-direction: column;
    }
    
    .impl-tab {
        width: 100%;
        text-align: center;
    }
    
    .data-pipeline {
        flex-direction: column;
    }
    
    .pipeline-arrow {
        transform: rotate(90deg);
        padding: 0;
    }
    
    .constraint-types-impl {
        grid-template-columns: 1fr;
    }
    
    .kg-construction-flow {
        flex-direction: column;
    }
    
    .kg-step-arrow {
        transform: rotate(90deg);
    }
}

/* ============================================
   RESPONSIVE
   ============================================ */
@media (max-width: 1024px) {
    .scene { padding: 60px 30px 100px; }
    .scene-title { font-size: 2rem; }
    .author-card { flex-direction: column; text-align: center; }
    .terminology-grid { grid-template-columns: 1fr; }
    .sources-grid { grid-template-columns: repeat(2, 1fr); }
    .rq-cards { grid-template-columns: 1fr; }
    .param-cards { grid-template-columns: repeat(2, 1fr); }
    .metrics-summary { grid-template-columns: 1fr; }
    .results-summary { grid-template-columns: 1fr; }
    .contributions-grid { grid-template-columns: 1fr; }
    .domains-grid { grid-template-columns: 1fr; }
    .perf-grid { grid-template-columns: repeat(2, 1fr); }
    .constraint-grid { grid-template-columns: repeat(2, 1fr); }
    .space-compare { flex-direction: column; }
    .key-results-preview { flex-wrap: wrap; justify-content: center; }
}

@media (max-width: 768px) {
    .audio-controls { display: none; }
    .scene-nav { display: none; }
    .narration-indicator { font-size: 0.8rem; padding: 8px 15px; }
    .scene { padding: 50px 20px 80px; }
    .scene-title { font-size: 1.6rem; }
    .title-logo { font-size: 3rem; }
    .main-title { font-size: 1.3rem; }
    .problem-grid { grid-template-columns: 1fr; }
    .facility-map { flex-direction: column; align-items: center; }
    .equation-display { flex-direction: column; }
    .fl-flow { flex-direction: column; }
    .nav-controls { padding: 10px 15px; }
    .nav-btn { padding: 10px 15px; font-size: 0.9rem; }
}
